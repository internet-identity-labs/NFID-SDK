"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[710],{51710:(e,t,a)=>{a.r(t),a.d(t,{default:()=>T});var n=a(64279),l=a(87273),i=a(8439),c=a(21882),s=a(54915),r=a(7863),o=a(95569),u=a(18414),d=a(74912),p=a(93302);const m=a.p+"static/media/nfid.2546d441d77e8702acfb8302ccf464ab.svg";var g=a(33693);const v=e=>{let{applicationLogo:t,applicationName:a,onReject:n,onApprove:l,accountsOptions:i,selectedAccounts:s,setSelectedAccounts:r,timer:o=!1}=e;return(0,g.jsx)(c.$$,{frameLabel:"Approve with NFID",children:(0,g.jsx)(p.B,{isLoading:!i.length,children:(0,g.jsxs)("div",{className:(0,u.Z)("flex flex-col flex-grow lg:justify-between","h-full"),children:[(0,g.jsxs)("div",{children:[(0,g.jsx)(c.x1,{applicationLogo:t,title:a,subTitle:"wants to perform the following actions:"}),(0,g.jsxs)("div",{className:(0,u.Z)("border border-gray-300 rounded-md","p-3 mt-4"),children:[(0,g.jsxs)("div",{className:"flex space-x-2.5 mb-2.5",children:[(0,g.jsx)("div",{className:(0,u.Z)("w-10 h-10 bg-gray-50 rounded-full","flex items-center justify-center","relative"),children:(0,g.jsx)("img",{className:"w-6",src:m,alt:"nfid"})}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm font-semibold",children:"View your Web3 balance"}),(0,g.jsx)("p",{className:"text-xs text-secondary",children:"This site will see tokens and history from your selected accounts"})]})]}),(0,g.jsx)(c.TV,{disabled:-1!==o,isSearch:!0,options:i,selectedValues:s,setSelectedValues:r,placeholder:"None selected - connect anonymously",showSelectAllOption:!0})]})]}),(0,g.jsxs)("div",{className:(0,u.Z)("grid grid-cols-2 gap-5 mt-5 lg:mt-32",-1!==o&&"hidden"),children:[(0,g.jsx)(d.z,{stroke:!0,onClick:n,children:"Reject"}),(0,g.jsx)(d.z,{primary:!0,onClick:l,children:"Approve"})]}),(0,g.jsxs)(d.z,{className:(0,u.Z)("mt-5 lg:mt-32",-1===o&&"hidden"),block:!0,primary:!0,children:["Success! Closing in ",o]})]})})})};var f=a(27221);const h=e=>{let{applicationLogo:t,applicationName:a,onSuccess:n}=e;const[i,c]=(0,l.useState)([]),{wallets:u}=(0,o.w)(),{counter:d,setCounter:p}=(0,f.J)({defaultCounter:-1}),m=(0,l.useMemo)((()=>null===u||void 0===u?void 0:u.map((e=>{var t,a;return{label:null!==(t=e.label)&&void 0!==t?t:"",value:null!==(a=(0,s.PZ)(e.principal))&&void 0!==a?a:"",afterLabel:`${(0,r.T9)(e.balance.ICP)} ICP`}}))),[u]),h=(0,l.useCallback)((()=>{p(5),setTimeout((()=>n(i)),5e3)}),[p,n,i]);return(0,g.jsx)(v,{applicationName:a,applicationLogo:t,onReject:()=>window.close(),onApprove:h,accountsOptions:null!==m&&void 0!==m?m:[],selectedAccounts:i,setSelectedAccounts:c,timer:d})};var y=a(62233),N=a(53844),I=a(84732),b=a(20663),w=a(99473);let A;const x=(0,N.C)({context:{},tsTypes:{},schema:{events:{}},initial:"Ready",states:{Ready:{invoke:{src:"registerRequestAccountsHandler",id:"registerRequestAccountsHandler",onDone:[{target:"Authenticate",actions:"assignRequestAccountsRequest"}]}},Authenticate:{invoke:{src:"AuthenticationMachine",id:"AuthenticationMachine",onDone:[{target:"RequestAccounts",actions:"assignAuthSession"}],data:e=>({appMeta:e.appMeta})}},RequestAccounts:{on:{SUCCESS:{target:"Confirm",actions:"assignAccounts"}}},Confirm:{onEntry:"setAccounts"},End:{type:"final"}},id:"RequestAccountsProvider"},{actions:{assignAuthSession:(0,I.f0)(((e,t)=>({authSession:t.data}))),assignRequestAccountsRequest:(0,I.f0)({requestAccounts:(e,t)=>t.data}),assignAccounts:(0,I.f0)({accounts:(e,t)=>t.accounts}),setAccounts:e=>{console.log({accounts:A,data:e}),A=e.accounts}},services:{async registerRequestAccountsHandler(){const e=await(0,b.registerRequestAccountsHandler)((()=>new Promise((e=>{setInterval((()=>{A&&e({status:"SUCCESS",accounts:A})}),1e3)}))));return console.debug("registerRequestAccountsHandler",{params:e}),e},AuthenticationMachine:w.Z},guards:{}});function T(){var e,t,a,s,r,o;const[u]=(0,i.lr)(),d=u.get("applicationName"),m=u.get("applicationLogo"),[v,f]=(0,n.e)(x.withConfig({},{appMeta:{name:d||"",logo:m||""}}));switch((0,l.useEffect)((()=>{console.debug("RequestAccountsCoordinator",{state:v.value})}),[v]),!0){case v.matches("Ready"):return(0,g.jsx)(p.B,{isLoading:!0,loadingMessage:`Connecting to ${null!==(e=null===(t=v.context)||void 0===t||null===(a=t.appMeta)||void 0===a?void 0:a.name)&&void 0!==e?e:"the application"}`});case v.matches("Authenticate"):return(0,g.jsx)(c.$$,{children:(0,g.jsx)(y.Z,{actor:v.children.AuthenticationMachine})});case v.matches("RequestAccounts"):return(0,g.jsx)(h,{applicationName:null===(s=v.context)||void 0===s||null===(r=s.appMeta)||void 0===r?void 0:r.name,applicationLogo:null===(o=v.context.appMeta)||void 0===o?void 0:o.logo,onSuccess:e=>{f({type:"SUCCESS",accounts:e})}});default:return console.debug(`RequestAccounts rendering loader, unknown state: ${JSON.stringify(v.value)}`),(0,g.jsx)(p.B,{isLoading:!0})}}},19864:(e,t,a)=>{a.d(t,{i:()=>i});var n=a(94244),l=a(8708);const i=()=>{const{data:e,isValidating:t}=(0,n.ZP)("dip20AllToken",l.o4,{dedupingInterval:36e5,focusThrottleInterval:36e5});return console.debug("useAllDip20Token",{token:e}),{token:e,isValidating:t}}},94159:(e,t,a)=>{a.d(t,{A1:()=>r,J4:()=>s,SP:()=>o});var n=a(13791),l=a(54915),i=a(21325),c=a(8708);async function s(e){let{principals:t,dip20Token:a}=e;return await Promise.all(t.map((async e=>{let{principal:t,account:n}=e;const s=await Promise.all([...["ICP"].map((async e=>({[e]:await(0,i.sb)((0,l.PZ)(t))}))),...a.map((async e=>{let{symbol:a,canisterId:n}=e;return{[a]:await(0,c.li)({canisterId:n,principalId:t.toText()})}}))]);return{principal:t,principalId:t.toText(),account:n,balance:s.reduce(((e,t)=>({...e,...t})),{})}})))}async function r(e){return await Promise.all(e.map((async e=>{var t;const a=n.Principal.fromText(VAULT_CANISTER_ID),c=(0,l.PZ)(a,(0,l.Wu)(e.uid)),s=await(0,i.sb)(c);return{principal:a,account:{domain:"nfid.vaults",label:null!==(t=e.name)&&void 0!==t?t:"",accountId:e.uid},principalId:a.toText(),address:c,balance:{ICP:s},vaultId:null===e||void 0===e?void 0:e.vaultId,vaultName:null===e||void 0===e?void 0:e.vaultName}})))}async function o(e){return await Promise.all(e.map((async e=>{const t=n.Principal.fromText(VAULT_CANISTER_ID),a=await(0,i.sb)((0,l.PZ)(t,(0,l.Wu)(e.uid)));return{...e,address:(0,l.PZ)(t,(0,l.Wu)(e.uid)),balance:{ICP:a}}})))}},14868:(e,t,a)=>{a.d(t,{j:()=>s});var n=a(94244),l=a(94159),i=a(65794),c=a(19864);const s=()=>{const{principals:e}=(0,i.J)(),{token:t}=(0,c.i)(),{data:a,isValidating:s,mutate:r}=(0,n.ZP)(t&&e?[e,t,"AllBalanceRaw"]:null,(async e=>{let[t,a]=e;return console.debug("AllBalanceRaw",{principals:t,dip20Token:a}),await(0,l.J4)({principals:t,dip20Token:a})}),{dedupingInterval:3e4,refreshInterval:6e4});return{balances:a,isLoading:s,refreshBalances:r}}},33492:(e,t,a)=>{a.d(t,{I:()=>s});var n=a(94244),l=a(36516),i=a(21325),c=a(67959);const s=()=>(0,n.ZP)("vaultDelegation",(()=>(0,c.a)()),{refreshInterval:l.EW,onSuccess:async e=>(e&&await(0,i.Ru)(i.UT,e),e)})},67959:(e,t,a)=>{a.d(t,{a:()=>s});var n=a(52259),l=a(21325),i=a(25390),c=a(23439);const s=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"nfid.one",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const s=await(0,c.In)();return"-1"!==t&&s.wallet===l.TD.II?await(0,i.p)(s.anchor,e,t):await(0,n.iu)(l.fD.get().delegationIdentity,n.qo.IC,l.KH.concat(a))}},25390:(e,t,a)=>{a.d(t,{p:()=>c});var n=a(52259),l=a(36516),i=a(21325);a(30365);async function c(e,t,a){arguments.length>3&&void 0!==arguments[3]||n.qo.IC;const c="undefined"===typeof t||"nfid.one"===t?l.Zp:(0,i.bR)(t,a);return i.YL.getDelegation(e,c,BigInt((0,i.Mz)(l.CP,"NFID_WALLET_DELEGATION_TTL_NS")))}},65794:(e,t,a)=>{a.d(t,{J:()=>s});var n=a(87273),l=a(72422),i=a(21325),c=a(69491);const s=()=>{const{profile:e}=(0,c.Un)(),{accounts:t}=(0,c.xe)(),{applicationsMeta:a}=(0,c.pq)(),s=n.useMemo((()=>(0,i.XZ)(t,a)),[t,a]),{data:r}=(0,l.Z)(null!==e&&void 0!==e&&e.anchor&&s?[BigInt(e.anchor),s,e.wallet===i.TD.NFID]:null,(e=>{let[t,a,n]=e;return(0,i.bt)(t,a,n)}),{dedupingInterval:6e4,refreshInterval:6e4});return console.debug("useAllPrincipals",{principals:r}),{principals:r}}},95569:(e,t,a)=>{a.d(t,{w:()=>p});var n=a(54915),l=a(87273),i=a(21325),c=a(14868),s=a(94244),r=a(94159),o=a(33492);var u=a(69491),d=a(93441);const p=()=>{const{balances:e,isLoading:t}=(0,c.j)(),{balances:a,isLoading:p}=(()=>{const{data:e}=(0,o.I)(),{data:t,isLoading:a}=(0,s.ZP)(e?"allVaultsWallets":null,(async()=>{const e=await(0,i._w)(),t=null===e||void 0===e?void 0:e.map((async e=>(await(0,i.MX)(e.id)).map((t=>({...t,vaultId:e.id,vaultName:e.name})))));return(await Promise.all(t)).flat(1).filter((e=>e.state!==i.Q$.ARCHIVED))})),{data:n,isValidating:l}=(0,s.ZP)(t?[t,"allVaultsWalletsBalances"]:null,(async e=>{let[t]=e;return console.debug("allVaultsWalletsBalances",{allVaultsWallets:t}),await(0,r.A1)(t)}),{dedupingInterval:3e4,refreshInterval:6e4});return{balances:n,isLoading:a||l}})(),m=(0,u.pq)();return{wallets:l.useMemo((()=>{var t;if(!e||!a)return[];const l=null===e||void 0===e?void 0:e.map((e=>{var t;let{principal:a,account:l,...c}=e;return{label:(0,i.w)(null!==(t=m.applicationsMeta)&&void 0!==t?t:[],l.domain,l.accountId),accountId:l.accountId,domain:l.domain,principal:a,address:(0,n.PZ)(a),...c}})).sort((0,d.E)((e=>{let{label:t}=e;return null!==t&&void 0!==t?t:""}))).concat(null!==(t=null===a||void 0===a?void 0:a.map((e=>{let{principal:t,account:a,address:n,...l}=e;return{label:a.label,accountId:a.accountId,domain:a.domain,principal:t,address:null!==n&&void 0!==n?n:a.accountId,isVaultWallet:!0,...l}})))&&void 0!==t?t:[]);return(0,d.h)((e=>{let{label:t}=e;return null!==t&&void 0!==t?t:""}),["NFID","NNS"])(l||[])}),[m.applicationsMeta,e,a]),isLoading:t||p}}},93441:(e,t,a)=>{a.d(t,{E:()=>n,h:()=>l});const n=e=>(t,a)=>e(t).localeCompare(e(a),"en",{sensitivity:"base"}),l=(e,t)=>a=>{const n=t.map((t=>a.find((a=>e(a).includes(t))))).filter((e=>Boolean(e)));return[...n,...a.filter((t=>!n.find((a=>e(a)===e(t)))))]}},27221:(e,t,a)=>{a.d(t,{J:()=>l});var n=a(87273);const l=e=>{let{defaultCounter:t,loop:a,frequency:l=1e3,onElapsed:i}=e;const[c,s]=n.useState(t),r=n.useRef(),[o,u]=n.useState(!1),d=n.useCallback((()=>{c>0&&s(c-1),0===c&&(u(!0),i&&i(),clearInterval(Number(r.current))),0===c&&a&&(s(t),r.current=setInterval(d,l),u(!1))}),[c,t,l,a,i]);return n.useEffect((()=>(r.current=setInterval(d,l),()=>clearInterval(Number(r.current)))),[l,d]),{elapsed:o,setCounter:s,counter:c}}},8708:(e,t,a)=>{a.d(t,{Gv:()=>m,o4:()=>u,li:()=>d,sd:()=>r,re:()=>p});var n=a(13791),l=(a(7863),a(96992)),i=a(42938);const c=(e,t)=>(0,i.$K)(e,m,t?{agent:new l.HttpAgent({...i.V6,identity:t})}:void 0);var s=a(66325);async function r(e){return c(e).getMetadata().then((t=>({canisterId:e,...t}))).catch((e=>{throw new Error(`getMetadata: ${e.message}`)}))}const o=e=>{let{decimals:t,...a}=e;return{decimals:t,toPresentation:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:BigInt(0);return Number(e)/Number(BigInt(10**t))},transformAmount:e=>Number(parseFloat(e)*10**t),...a}};async function u(){return await Promise.all(s.X.map(r)).then((e=>e.map(o)))}const d=async e=>{let{canisterId:t,principalId:a}=e;return c(t).balanceOf(n.Principal.fromText(a)).catch((e=>{throw new Error(`getBalance: ${e.message}`)}))};async function p(e){let{canisterId:t,to:a,amount:l,sourceIdentity:i}=e;console.debug("transfer",{canisterId:t,to:a,amount:l});const s=c(t,i),r=await s.transfer(n.Principal.fromText(a),BigInt(l)).catch((e=>{throw Error(`transfer failed: ${e}`)}));if("Err"in r){if("Other"in r.Err)throw Error(r.Err.Other);throw Error(Object.keys(r.Err)[0])}return console.debug("transfer",{response:r}),r.Ok}const m=e=>{let{IDL:t}=e;const a=t.Variant({InsufficientAllowance:t.Null,InsufficientBalance:t.Null,ErrorOperationStyle:t.Null,Unauthorized:t.Null,LedgerTrap:t.Null,ErrorTo:t.Null,Other:t.Text,BlockUsed:t.Null,AmountTooSmall:t.Null}),n=t.Variant({Ok:t.Nat,Err:a}),l=t.Record({fee:t.Nat,decimals:t.Nat8,owner:t.Principal,logo:t.Text,name:t.Text,totalSupply:t.Nat,symbol:t.Text}),i=t.Record({holderNumber:t.Nat64,deployTime:t.Nat64,metadata:l,historySize:t.Nat64,cycles:t.Nat64,feeTo:t.Principal});return t.Service({allowance:t.Func([t.Principal,t.Principal],[t.Nat],["query"]),approve:t.Func([t.Principal,t.Nat],[n],[]),balanceOf:t.Func([t.Principal],[t.Nat],["query"]),burn:t.Func([t.Nat],[n],[]),decimals:t.Func([],[t.Nat8],["query"]),getAllowanceSize:t.Func([],[t.Nat64],["query"]),getHolders:t.Func([t.Nat64,t.Nat64],[t.Vec(t.Tuple(t.Principal,t.Nat))],["query"]),getMetadata:t.Func([],[l],["query"]),getTokenInfo:t.Func([],[i],["query"]),getUserApprovals:t.Func([t.Principal],[t.Vec(t.Tuple(t.Principal,t.Nat))],["query"]),historySize:t.Func([],[t.Nat64],["query"]),logo:t.Func([],[t.Text],["query"]),mint:t.Func([t.Principal,t.Nat],[n],[]),name:t.Func([],[t.Text],["query"]),owner:t.Func([],[t.Principal],["query"]),setFee:t.Func([t.Nat],[],[]),setFeeTo:t.Func([t.Principal],[],[]),setLogo:t.Func([t.Text],[],[]),setName:t.Func([t.Text],[],[]),setOwner:t.Func([t.Principal],[],[]),symbol:t.Func([],[t.Text],["query"]),totalSupply:t.Func([],[t.Nat],["query"]),transfer:t.Func([t.Principal,t.Nat],[n],[]),transferFrom:t.Func([t.Principal,t.Principal,t.Nat],[n],[])})}}}]);
//# sourceMappingURL=710.84a70c20.chunk.js.map