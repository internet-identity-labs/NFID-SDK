"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[136],{13485:(e,t,n)=>{n.d(t,{Z:()=>r});n(87273);const r=n.p+"static/media/dfinity.583ab84ba16070ca501453d1e291dff4.svg"},26050:(e,t,n)=>{n.r(t),n.d(t,{default:()=>A});var r=n(64279),o=n(8439),a=n(53844),i=n(84732),s=n(29307),c=n(78765),l=n(23439),u=n(71516),d=n(95063);var p=n(77404);async function f(e){return c.Ym.resolve_token(e).then(c.yH).then(m)}function m(e){return e?{domain:e.domain,clientPrincipal:e.client_principal,phoneNumberSha2:(0,c.yH)(e.phone_number_sha2),createdDate:(0,p.dr)(e.created_date)}:e}var h=n(29323);let v,g=!1;const y=(0,a.C)({context:{},tsTypes:{},schema:{events:{}},id:"PhoneNumberCredentialProvider",initial:"Ready",states:{Ready:{invoke:{src:"registerCredentialHandler",id:"registerCredentialHandler",onDone:{target:"Authenticate",actions:"assignCredentialRequest"}}},Authenticate:{invoke:{src:"AuthenticationMachine",id:"AuthenticationMachine",onDone:[{cond:"isDev",target:"DevClearData",actions:"assignAuthSession"},{target:"GetPhoneNumber",actions:"assignAuthSession"}],data:e=>({appMeta:e.appMeta})}},DevClearData:{onDone:"GetPhoneNumber",initial:"Start",states:{Start:{on:{CLEAR_DATA:"Clear",END:"End"}},Clear:{invoke:{src:"clearAccountData",id:"clearAccountData",onDone:"End"}},End:{type:"final"}}},GetPhoneNumber:{initial:"GetExistingPhoneNumber",states:{GetExistingPhoneNumber:{invoke:{src:"fetchPhoneNumber",id:"fetchPhoneNumber",onDone:[{actions:"assignEncryptedPN",cond:"defined",target:"End"},{target:"EnterPhoneNumber"}]}},EnterPhoneNumber:{on:{ENTER_PHONE_NUMBER:{actions:"assignPhoneNumber",target:"VerifyPhoneNumber"}}},VerifyPhoneNumber:{invoke:{src:"verifyPhoneNumberService",id:"verifyPhoneNumberService",onError:"EnterPhoneNumber",onDone:{target:"EnterSMSToken",actions:"assignEncryptedPN"}}},EnterSMSToken:{on:{CHANGE_PHONE_NUMBER:"EnterPhoneNumber",ENTER_SMS_TOKEN:"ValidateSMSToken",RESEND:"VerifyPhoneNumber"}},ValidateSMSToken:{invoke:{src:"verifySmsService",id:"verifySmsService",onDone:[{cond:"bool",target:"End"},{target:"EnterSMSToken"}],onError:"EnterSMSToken"}},End:{type:"final"}},onDone:"Consent"},Consent:{on:{CONSENT:"GenerateCredential",REJECT:{target:"End",actions:"rejectCredential"}}},GenerateCredential:{invoke:{src:"generateCredential",id:"generateCredential",onDone:{actions:"presentCredential",target:"End"},onError:{target:"Consent"}}},End:{type:"final"}}},{actions:{assignAuthSession:(0,i.f0)(((e,t)=>({authSession:t.data}))),assignCredentialRequest:(0,i.f0)({token:(e,t)=>t.data}),assignPhoneNumber:(0,i.f0)(((e,t)=>{let{data:n}=t;return{phone:n}})),assignEncryptedPN:(0,i.f0)(((e,t)=>({encryptedPN:t.data}))),presentCredential:()=>{v={status:"SUCCESS"},g=!0},rejectCredential:()=>{v={status:"REJECTED",message:"User declined to provide credential"},g=!0}},services:{fetchPhoneNumber:async()=>(await(0,l.In)()).phoneNumber,async clearAccountData(){await(0,l.Zd)(),(0,c.FZ)()},async registerCredentialHandler(){const e=await(0,s.registerPhoneNumberCredentialHandler)((()=>new Promise((e=>{setInterval((()=>g&&e(v)),1e3)}))));if(console.debug(s.registerPhoneNumberCredentialHandler.name,{token:e}),!Array.isArray(e)||e.find((e=>"number"!==typeof e)))throw console.error(e),new Error("Received an invalid token.");return e},verifyPhoneNumberService:async function e(t){try{const{authSession:n,phone:r}=t;if(!n)throw new Error("Missing session");if(!r)throw new Error("Missing phone number");const o=n.delegationIdentity;return console.debug(e.name,{principal:o.getPrincipal().toText(),context:t}),await(0,d.V)(r,o)}catch(n){throw console.error("Error in verifyPhoneNumberService",n),new Error("There was an issue verifying your phone number, please try again.")}},verifySmsService:u.wo,AuthenticationMachine:h.Z,generateCredential:async function e(t){let{token:n}=t;if(!n)throw new Error("Missing token");return console.debug(e.name,{token:n}),async function(e){console.debug("getPhoneCredential",{token:e});for(let n=0;n<3;n++){await new Promise((e=>{setInterval(e,100*n)}));try{return await f(e).catch((e=>{throw console.error("Error with token resolution",e),e}))}catch(t){console.log("retrying...")}}throw new Error("Failed to retrieve a delegation after 10 retries.")}(n)}},guards:{defined:function(e,t){return void 0!==t.data},bool:function(e,t){return t.data},isDev:function(){return"true"===c.ic.isDev}}}),b=y;var N=n(74912),_=n(93302),w=n(18414),E=n(87273),x=n(84463),P=n(82898),C=n(63468),S=n(33693);const j=e=>{var t;let{applicationLogo:n,applicationName:r,onSubmit:o,isLoading:a,loadingMessage:i,error:s,phoneNumber:c}=e;const{register:l,handleSubmit:u,formState:{errors:d,isDirty:p}}=(0,x.cI)({mode:"all",defaultValues:{phone:c||""}});return(0,S.jsxs)(_.B,{loadingMessage:i,isLoading:a,children:[(0,S.jsx)(P.x1,{applicationName:r,applicationLogo:n,title:"Verification request",subTitle:`to continue to ${null!==r&&void 0!==r?r:"the application"}`}),(0,S.jsx)(C.P,{className:"text-sm mt-7",children:"This application is requesting you verify a non-VOIP phone number with NFID to continue."}),(0,S.jsxs)(C.P,{className:"mt-2 text-sm",children:["To register it with your existing Internet Identity anchor please see these"," ",(0,S.jsx)("a",{className:"transition-opacity cursor-pointer text-blue hover:opacity-75",href:"https://docs.nfid.one/sign-in-with-ii-and-nfid",target:"_blank",rel:"noreferrer",children:"instructions"}),"."]}),(0,S.jsxs)("form",{className:(0,w.Z)("mt-6 flex flex-col justify-between flex-1","sm:block"),onSubmit:u(o),children:[(0,S.jsx)("div",{className:"space-y-2",children:(0,S.jsx)(P.II,{type:"text",labelText:"Phone number",placeholder:"+XX XXX XXX XX XX",errorText:s||(null===(t=d.phone)||void 0===t?void 0:t.message),...l("phone",{required:P.DE.errorMessages.required,pattern:{value:P.DE.regex,message:P.DE.errorMessages.pattern},minLength:{value:P.DE.minLength,message:P.DE.errorMessages.length},maxLength:{value:P.DE.maxLength,message:P.DE.errorMessages.length}})})}),(0,S.jsx)(N.z,{primary:!0,className:"px-10 sm:mt-2",block:!0,onClick:u(o),disabled:!p||!!d.phone,children:"Verify phone number"})]})]})};var O=n(27016),T=n(27221);const k=e=>{let{applicationLogo:t,applicationName:n,onResendCode:r,phone:o,onSubmit:a,responseError:i,onChangePhone:s,isLoading:c,loadingMessage:l}=e;const{counter:u,setCounter:d}=(0,T.J)({defaultCounter:3});return(0,S.jsxs)(_.B,{isLoading:c,loadingMessage:l,children:[(0,S.jsx)(P.x1,{applicationLogo:t,applicationName:n,title:"SMS verification"}),(0,S.jsxs)("div",{className:(0,w.Z)("mt-5 flex flex-col justify-between flex-1","sm:block"),children:[(0,S.jsxs)("div",{className:"mt-3 text-sm sm:mt-14",children:["Please enter the verification code that was sent to ",o,".",(0,S.jsx)("br",{}),u>0?(0,S.jsxs)(C.P,{className:"mt-3",children:["Code can be resent in ",u," sec"]}):(0,S.jsxs)(C.P,{className:"mt-3",children:["Didn\u2019t receive a code?"," ",(0,S.jsx)("span",{className:"cursor-pointer text-blue",onClick:()=>{r&&r(),d(60)},children:"Resend"})]})]}),(0,S.jsx)(O.Y,{className:"justify-between",onSubmit:a,errorClasses:"text-center",buttonText:"Verify phone number",responseError:i,buttonClassName:"w-full"}),(0,S.jsx)(N.z,{text:!0,onClick:s,className:"w-full mt-4 mb-8 text-sm text-center cursor-pointer text-blue hover:text-blue-hover",children:"Change phone number"})]})]})},R=e=>{let{children:t,className:n,text:r,value:o,name:a,disabled:i,onClick:s,...c}=e;return(0,S.jsx)("div",{className:"flex items-center mb-4",onClick:s,children:(0,S.jsxs)("div",{className:"inline-flex items-center",children:[(0,S.jsx)("input",{type:"radio",disabled:i,id:a,name:a,value:o,className:"w-5 h-5 hover:ring-2 hover:ring-blue-200 focus:ring-2 focus:ring-offset-2 focus:ring-black",...c}),(0,S.jsx)(P.__,{htmlFor:a,className:"ml-3 !mb-0",children:r})]})})};function M(e){return(0,S.jsx)("div",{className:(0,w.Z)("py-1 text-sm text-red-base"),children:e.children})}const I=e=>{let{applicationLogo:t,applicationName:n,onPresent:r,onSkip:o,error:a}=e;const[i,s]=E.useState("rb_present");return(0,S.jsxs)(_.B,{isLoading:!1,children:[(0,S.jsx)(P.x1,{applicationName:n,applicationLogo:t,title:"Verification request",subTitle:`to continue to ${null!==n&&void 0!==n?n:"the application"}`}),(0,S.jsx)(C.P,{className:"mt-5 text-sm",children:"You already have a verified phone credential from Internet Identity Labs."}),(0,S.jsx)(C.P,{className:"mt-2 text-sm",children:"Would you like to present it now?"}),(0,S.jsxs)("div",{className:"py-3",children:[(0,S.jsx)(R,{onChange:()=>s("rb_present"),checked:"rb_present"===i,value:"rb_present",name:"rb_present",text:"Yes, present it anonymously"}),(0,S.jsx)(R,{onChange:()=>s("rb_skip"),checked:"rb_skip"===i,value:"rb_skip",name:"rb_skip",text:"Skip for now"})]}),(0,S.jsx)(N.z,{primary:!0,className:"px-10 mb-6 sm:mt-2",block:!0,onClick:()=>{"rb_present"===i?r():o()},children:"Continue"}),a&&(0,S.jsx)(M,{children:a})]})};var D=n(8880);function A(e){var t,n,a,i,s,c,l,u;let{machine:d}=e;const[p,f]=(0,r.e)(d||b),[m]=(0,o.lr)();switch(!0){case p.matches("Ready"):return(0,S.jsx)(_.B,{isLoading:!0,loadingMessage:`Connecting to ${null!==(t=null===(n=p.context.appMeta)||void 0===n?void 0:n.name)&&void 0!==t?t:"the application"}`});case p.matches("Authenticate"):return(0,S.jsx)(D.d,{actor:p.children.AuthenticationMachine});case p.matches("DevClearData"):return(0,S.jsxs)(S.Fragment,{children:["Would you like to wipe this account for testing purposes?",(0,S.jsx)(N.z,{onClick:()=>f("CLEAR_DATA"),children:"Yes"}),(0,S.jsx)(N.z,{onClick:()=>f("END"),children:"No"})]});case p.matches("Consent"):const e="error.platform.generateCredential"===p.event.type?"There was a problem generating your credential. Please try again.":void 0;return console.log(p.event.type),(0,S.jsx)(I,{onPresent:()=>f("CONSENT"),onSkip:()=>f("REJECT"),error:e,applicationName:null!==(a=m.get("applicationName"))&&void 0!==a?a:"",applicationLogo:null!==(i=m.get("applicationLogo"))&&void 0!==i?i:""});case p.matches("GetPhoneNumber.GetExistingPhoneNumber"):case p.matches("GetPhoneNumber.VerifyPhoneNumber"):case p.matches("GetPhoneNumber.EnterPhoneNumber"):return(0,S.jsx)(j,{onSubmit:e=>f({type:"ENTER_PHONE_NUMBER",data:e.phone}),isLoading:p.matches("GetPhoneNumber.GetExistingPhoneNumber")||p.matches("GetPhoneNumber.VerifyPhoneNumber"),loadingMessage:p.matches("GetPhoneNumber.VerifyPhoneNumber")?"Generating SMS token":p.matches("GetPhoneNumber.GetExistingPhoneNumber")?"Checking for phone number":"",error:"data"in p.event&&"object"===typeof p.event.data&&"error"in p.event.data?p.event.data.error:void 0,phoneNumber:p.context.phone,applicationName:null!==(s=m.get("applicationName"))&&void 0!==s?s:"",applicationLogo:null!==(c=m.get("applicationLogo"))&&void 0!==c?c:""});case p.matches("GetPhoneNumber.EnterSMSToken"):case p.matches("GetPhoneNumber.ValidateSMSToken"):return(0,S.jsx)(k,{onSubmit:e=>f({type:"ENTER_SMS_TOKEN",data:e}),onChangePhone:()=>f("CHANGE_PHONE_NUMBER"),onResendCode:()=>f("RESEND",p.event.data),phone:p.context.phone,responseError:"data"in p.event&&"object"===typeof p.event.data&&"error"in p.event.data?p.event.data.error:void 0,isLoading:p.matches("GetPhoneNumber.ValidateSMSToken"),loadingMessage:"Validating token",applicationName:null!==(l=m.get("applicationName"))&&void 0!==l?l:"",applicationLogo:null!==(u=m.get("applicationLogo"))&&void 0!==u?u:""});case p.matches("GenerateCredential"):return(0,S.jsx)(_.B,{isLoading:!0,loadingMessage:"Creating verifiable credential"});default:return console.debug(`PhoneCredentialCoordinator rendering loader, unknown state: ${JSON.stringify(p.value)}`),(0,S.jsx)(_.B,{isLoading:!0})}}},95063:(e,t,n)=>{n.d(t,{V:()=>c});var r=n(46829),o=n(33896),a=n(71520),i=(n(46647),n(30935),n(78765)),s=n(15698);if(!VERIFY_PHONE_NUMBER)throw new Error("Phone verification lambda is not defined.");async function c(e,t){const n=i.ic.isLocal?"/verify":VERIFY_PHONE_NUMBER,c=e.replace(/\s/g,""),l={methodName:"validate_signature",arg:o.xO.encode([o.xO.Opt(o.xO.Text)],[[c]])},u=await(0,s.G)(t,IDENTITY_MANAGER_CANISTER_ID,l);let d=r.Cbor.encode(u.body),p=(0,a.zv)(d);const f=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:p})});if(console.debug("verifyPhoneNumber",{phoneNumber:e,fields:l,canister:IDENTITY_MANAGER_CANISTER_ID,response:f,principal:t.getPrincipal().toText()}),!f.ok){const e=await f.json().then((e=>e));throw console.log({errorObject:e}),Error(e.error)}return(await f.json()).phoneNumberEncrypted}},15698:(e,t,n)=>{n.d(t,{G:()=>a});var r=n(46829),o=n(13791);async function a(e,t,n){const a="string"===typeof t?o.Principal.fromText(t):t,i=e.getPrincipal(),s={request_type:"query",canister_id:a,method_name:n.methodName,arg:n.arg,sender:i,ingress_expiry:new r.Expiry(3e5)};return await e.transformRequest({request:{method:"POST",headers:Object.assign({"Content-Type":"application/cbor"})},endpoint:"query",body:s})}},27016:(e,t,n)=>{n.d(t,{Y:()=>l});var r=n(18414),o=n(87273),a=n(84463),i=n(82898),s=n(74912),c=n(33693);const l=e=>{var t,n;let{className:l,onSubmit:u,errorClasses:d,responseError:p,resetResponseError:f,buttonText:m,buttonClassName:h}=e;const[v,g]=o.useState(!1),y=Array.from(Array(6).keys()),b=o.useRef([]),{formState:{errors:N},setError:_,clearErrors:w,getFieldState:E}=(0,a.cI)({mode:"all"}),x=o.useCallback((()=>b.current.map((e=>null===e||void 0===e?void 0:e.value)).join("")),[E("verificationCode")]),P=o.useCallback((e=>{if("Backspace"===e.key||"Delete"===e.key){var t;const e=document.activeElement,r=Number(null===e||void 0===e?void 0:e.getAttribute("data-pin-index"));var n;if(r&&(null===(t=b.current[r])||void 0===t||!t.value))null===(n=b.current[r-1])||void 0===n||n.focus()}}),[]),C=o.useCallback((e=>{var t;const n=null===(t=e.clipboardData)||void 0===t?void 0:t.getData("text/plain");n&&(0,i.wu)(n)&&(b.current.forEach(((e,t)=>{var r;e&&(e.value=n[t],null===(r=b.current[t])||void 0===r||r.blur())})),w("verificationCode"))}),[w]),S=o.useCallback((()=>{w("verificationCode"),g(6===x().length)}),[w,x]);o.useEffect((()=>(document.addEventListener("paste",C),document.addEventListener("keydown",P),()=>{document.removeEventListener("paste",C)})),[P,C]),o.useEffect((()=>{null!==p&&void 0!==p&&p.length?_("verificationCode",{type:"manual",message:p}):S()}),[S,p,_]);const j=o.useCallback((()=>{v&&u(x())}),[x,v,u]);return(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{id:"pin-input",className:(0,r.Z)("flex space-x-3",l),children:y.map(((e,t)=>{var n,r;return(0,c.jsx)(i.II,{id:`pin-input-${t}`,pin:!0,type:"number",autoFocus:0===t,"data-pin-index":t,ref:e=>b.current[t]=e,onChange:e=>((e,t)=>{var n;if(f&&null!==p&&void 0!==p&&p.length&&(f(),w("verificationCode")),null===(n=b.current[t])||void 0===n?void 0:n.value.match(e.target.pattern)){var r,o;t===y.length-1&&(null===(o=b.current[t])||void 0===o||o.blur()),null===(r=b.current[t+1])||void 0===r||r.focus()}else e.target.value=e.target.value[0];g(6===x().length)})(e,t),maxLength:1,pattern:"^[0-9]{1}$",isErrorStyles:!(null===(n=N.verificationCode)||void 0===n||null===(r=n.message)||void 0===r||!r.length)},t)}))}),(0,c.jsx)("div",{id:"pin-input-error",className:(0,r.Z)("py-1 text-sm text-red-base",d),children:(null===(t=N.verificationCode)||void 0===t?void 0:t.message)||(null===(n=N.phonenumber)||void 0===n?void 0:n.message)}),(0,c.jsx)(s.z,{id:"send-pin",primary:!0,className:(0,r.Z)("px-10 mt-3 sm:mt-5",h),onClick:()=>{(()=>{const e=x();e.length!==i.PH.minLength?_("verificationCode",{type:"manual",message:i.PH.errorMessages.length}):(0,i.wu)(e)?w("verificationCode"):_("verificationCode",{type:"manual",message:i.PH.errorMessages.pattern})})(),j()},disabled:!v,children:m})]})}},75205:(e,t,n)=>{n.d(t,{Gr:()=>i,g_:()=>a});var r=n(20964),o=n.n(r);const a=()=>o().getParser(window.navigator.userAgent).getBrowser().name,i=e=>(/^(http|https):\/\//.test(e)||(e=`${window.location.protocol}//${e}`),new URL(e))},27221:(e,t,n)=>{n.d(t,{J:()=>o});var r=n(87273);const o=e=>{let{defaultCounter:t,loop:n,frequency:o=1e3,onElapsed:a}=e;const[i,s]=r.useState(t),c=r.useRef(),[l,u]=r.useState(!1),d=r.useCallback((()=>{i>0&&s(i-1),0===i&&(u(!0),a&&a(),clearInterval(Number(c.current))),0===i&&n&&(s(t),c.current=setInterval(d,o),u(!1))}),[i,t,o,n,a]);return r.useEffect((()=>(c.current=setInterval(d,o),()=>clearInterval(Number(c.current)))),[o,d]),{elapsed:l,setCounter:s,counter:i}}},21007:(e,t,n)=>{n.r(t),n.d(t,{__assign:()=>a,__asyncDelegator:()=>_,__asyncGenerator:()=>N,__asyncValues:()=>w,__await:()=>b,__awaiter:()=>u,__classPrivateFieldGet:()=>S,__classPrivateFieldIn:()=>O,__classPrivateFieldSet:()=>j,__createBinding:()=>p,__decorate:()=>s,__exportStar:()=>f,__extends:()=>o,__generator:()=>d,__importDefault:()=>C,__importStar:()=>P,__makeTemplateObject:()=>E,__metadata:()=>l,__param:()=>c,__read:()=>h,__rest:()=>i,__spread:()=>v,__spreadArray:()=>y,__spreadArrays:()=>g,__values:()=>m});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function o(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},a.apply(this,arguments)};function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function s(e,t,n,r){var o,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,n,i):o(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i}function c(e,t){return function(n,r){t(n,r,e)}}function l(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)}function u(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(s){a=[6,s],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var p=Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function f(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||p(t,e,n)}function m(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e}function g(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}function y(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function b(e){return this instanceof b?(this.v=e,this):new b(e)}function N(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=o[e](t)).value instanceof b?Promise.resolve(n.value.v).then(c,l):u(a[0][2],n)}catch(r){u(a[0][3],r)}var n}function c(e){s("next",e)}function l(e){s("throw",e)}function u(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}}function _(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,o){t[r]=e[r]?function(t){return(n=!n)?{value:b(e[r](t)),done:"return"===r}:o?o(t):t}:o}}function w(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=m(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}function E(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var x=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&p(t,e,n);return x(t,e),t}function C(e){return e&&e.__esModule?e:{default:e}}function S(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function j(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n}function O(e,t){if(null===t||"object"!==typeof t&&"function"!==typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"===typeof e?t===e:e.has(t)}},8737:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(21007);r.__exportStar(n(11227),t),r.__exportStar(n(75650),t)},75650:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateSameOrigin=t.validateEventOrigin=void 0,t.validateEventOrigin=function(e,t){return e.origin===t||(console.warn(`WARNING: expected origin '${t}', got '${e.origin}' (ignoring)`),!1)},t.validateSameOrigin=function(e,t){return console.debug("validateSameOrigin",{origin:t,event:e}),e.source===t||(console.warn("WARNING: expected same origin (ignoring)",{event:e,origin:t}),!1)}},11227:(e,t)=>{let n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.done=t.postMessageToClient=t.postMessageToProvider=t.stringifyWindowFeatures=t.defaultWindowFeatures=t.createWindow=void 0;function o(e){return Object.entries(e).reduce(((e,[t,n])=>{return`${e}${r=t,o=n,`${r}=${"boolean"===typeof o?o?1:0:o}`},`;var r,o}),"")}t.createWindow=function(e,a,i){r=new URL(e).origin,null===n||void 0===n||n.close(),n=window.open(e,"nfidSdk",i?"string"===typeof i?i:o(Object.assign(Object.assign({},t.defaultWindowFeatures),i)):o(t.defaultWindowFeatures)),setTimeout((function e(){(null===n||void 0===n?void 0:n.closed)?a(new Error("Terminated by user.")):setTimeout(e,1e3)}),1e3)},t.defaultWindowFeatures={height:705,width:525,top:window.screen.height/2-352.5,left:window.screen.width/2-262.5,toolbar:!1,location:!1,menubar:!1},t.stringifyWindowFeatures=o,t.postMessageToProvider=function(e){null===n||void 0===n||n.postMessage(e,r)},t.postMessageToClient=function(e){window.opener.postMessage(e,"*")},t.done=function(){null===n||void 0===n||n.close(),n=null}},51222:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPersonaDomain=void 0,t.getPersonaDomain=function(e){const t=new URL(e.toString());return`${t.protocol}//${t.host}`}},39039:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.verifyPhoneNumberCredential=t.requestPhoneNumberCredential=t.VERIFIER_CANISTER_ID_PROD=t.VERIFIER_CANISTER_ID_DEV=void 0;const r=n(21007),o=n(46829),a=n(76264),i=n(8737),s=n(78644),c=n(51222);t.VERIFIER_CANISTER_ID_DEV="gzqxf-kqaaa-aaaak-qakba-cai",t.VERIFIER_CANISTER_ID_PROD="sgk26-7yaaa-aaaan-qaovq-cai";const l=t.VERIFIER_CANISTER_ID_PROD;t.requestPhoneNumberCredential=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=(null===t||void 0===t?void 0:t.provider)||a.defaultProvider,u=(null===t||void 0===t?void 0:t.windowFeatures)||i.defaultWindowFeatures,d=(null===t||void 0===t?void 0:t.verifier)||l;return new Promise((t=>{const a=function(e,t,n,a){return function l(u){return r.__awaiter(this,void 0,void 0,(function*(){if((0,i.validateEventOrigin)(u,t.origin)){if("Ready"===u.data.kind){console.info("Creating certificate with app delegation to await resolution from NFID delegation.");const e=yield o.Actor.createActor(s.idlFactory,{canisterId:n,agent:new o.HttpAgent({identity:a,host:"https://ic0.app"})}).generate_pn_token((0,c.getPersonaDomain)(window.location)).then((e=>Array.from(e)));console.info("Credential provider is ready, request credential."),(0,i.postMessageToProvider)({kind:"RequestPhoneNumberCredential",token:e})}"PhoneNumberCredentialResponse"===u.data.kind&&(console.info("Credential flow is complete.",u.data.result),window.removeEventListener("message",l),e(u.data.result),(0,i.done)())}}))}}(t,n,d,e);window.addEventListener("message",a),window.onbeforeunload=()=>{window.removeEventListener("message",a)},(0,i.createWindow)(n.toString(),(()=>t({status:"ERROR",message:"Terminated by user"})),u)}))}))},t.verifyPhoneNumberCredential=function(e,t=l){return r.__awaiter(this,void 0,void 0,(function*(){console.debug("verifyPhoneNumberCredential",{ownerPrincipal:e,verifier:t});const n=o.Actor.createActor(s.idlFactory,{canisterId:t}),r=yield n.is_phone_number_approved(e);return console.debug("verifyPhoneNumberCredential",{ownerPrincipal:e,result:r}),r.data[0]}))}},76264:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultProvider=void 0;const r=n(21007);r.__exportStar(n(39039),t),r.__exportStar(n(18306),t),t.defaultProvider=new URL("https://nfid.one/credential/verified-phone-number")},18306:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.registerPhoneNumberCredentialHandler=void 0;const r=n(21007),o=n(8737);t.registerPhoneNumberCredentialHandler=function(e){const t=new Promise((t=>{window.addEventListener("message",(n=>r.__awaiter(this,void 0,void 0,(function*(){(0,o.validateSameOrigin)(n,window.opener)&&"RequestPhoneNumberCredential"===n.data.kind&&(t(n.data.token),console.info("Phone number credential request received, triggering handler.",n),(0,o.postMessageToClient)({kind:"PhoneNumberCredentialResponse",result:yield e()}),window.close())}))))}));return(0,o.postMessageToClient)({kind:"Ready"}),t}},78644:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.idlFactory=void 0;t.idlFactory=({IDL:e})=>{const t=e.Record({identity_manager:e.Text,token_ttl:e.Opt(e.Nat64)}),n=e.Record({analyzeCount:e.Nat32,messageRegex:e.Opt(e.Text),messageContains:e.Opt(e.Text)}),r=e.Nat64,o=e.Record({count:e.Nat32,filter:e.Opt(n),fromTimeNanos:e.Opt(r)}),a=e.Record({upToTimeNanos:e.Opt(r),count:e.Nat32,filter:e.Opt(n)}),i=e.Variant({getMessagesInfo:e.Null,getMessages:o,getLatestMessages:a}),s=e.Variant({filterMessageByContains:e.Null,filterMessageByRegex:e.Null}),c=e.Record({features:e.Vec(e.Opt(s)),lastTimeNanos:e.Opt(r),count:e.Nat32,firstTimeNanos:e.Opt(r)}),l=e.Record({timeNanos:r,message:e.Text}),u=e.Record({data:e.Vec(l),lastAnalyzedMessageTimeNanos:e.Opt(r)}),d=e.Variant({messagesInfo:c,messages:u}),p=e.Variant({hourly:e.Null,daily:e.Null}),f=e.Record({dateToMillis:e.Nat,granularity:p,dateFromMillis:e.Nat}),m=e.Vec(e.Nat64),h=e.Vec(e.Nat64),v=e.Vec(e.Nat64),g=e.Vec(e.Nat64),y=e.Record({updateCalls:m,canisterHeapMemorySize:h,canisterCycles:v,canisterMemorySize:g,timeMillis:e.Int}),b=e.Record({avg:e.Nat64,max:e.Nat64,min:e.Nat64,first:e.Nat64,last:e.Nat64}),N=e.Record({updateCalls:e.Nat64,canisterHeapMemorySize:b,canisterCycles:b,canisterMemorySize:b,timeMillis:e.Int}),_=e.Variant({hourly:e.Vec(y),daily:e.Vec(N)}),w=e.Record({data:_}),E=e.Record({data:e.Opt(e.Bool),error:e.Opt(e.Text),status_code:e.Nat16}),x=e.Record({domain:e.Text,client_principal:e.Text,phone_number_sha2:e.Opt(e.Text),created_date:e.Nat64});return e.Service({collectCanisterMetrics:e.Func([],[],[]),configure:e.Func([t],[],[]),generate_pn_token:e.Func([e.Text],[e.Vec(e.Nat8)],[]),getCanisterLog:e.Func([e.Opt(i)],[e.Opt(d)],["query"]),getCanisterMetrics:e.Func([f],[e.Opt(w)],["query"]),is_phone_number_approved:e.Func([e.Text],[E],[]),resolve_token:e.Func([e.Vec(e.Nat8)],[e.Opt(x)],[])})}},29307:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});n(21007).__exportStar(n(76264),t)}}]);
//# sourceMappingURL=136.2b73ace3.chunk.js.map