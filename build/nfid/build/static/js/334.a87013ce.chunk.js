"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[334],{91004:(e,r,t)=>{t.r(r),t.d(r,{default:()=>y});var n=t(59794),s=t(87273),a=t(96349),o=t(69491),i=t(78765),l=t(95063),c=t(18414),u=t(27016),d=t(63468),v=t(47200),m=t(72565),f=t(27221),p=t(33693);const h=e=>{let{onResendCode:r,onSubmit:t,responseError:n,resetResponseError:s,isLoading:a,phone:o,resendDelay:i=60}=e;const{counter:l,setCounter:h}=(0,f.J)({defaultCounter:i});return(0,p.jsx)(m.Z,{pageTitle:"SMS verification",isLoading:a,showBackButton:!0,children:(0,p.jsxs)(v.Z,{children:[(0,p.jsxs)("div",{className:"text-sm",children:[(0,p.jsxs)(d.P,{children:["Please enter the verification code that was sent to ",o,"."]}),(0,p.jsx)(d.P,{className:"mt-3",children:l>0?`Code can be resent in ${l} sec`:(0,p.jsxs)(p.Fragment,{children:["Didn't receive a code?"," ",(0,p.jsx)("span",{className:"cursor-pointer text-blue",onClick:()=>{r&&r(),h(i)},children:"Resend"})]})})]}),(0,p.jsx)("div",{className:(0,c.Z)("mt-5 flex flex-col justify-between flex-1","sm:block"),children:(0,p.jsx)(u.Y,{onSubmit:t,buttonText:"Complete",responseError:n,resetResponseError:s})})]})})};var b=t(19511),g=t(46520),x=t(1435);const y=()=>{const[e]=(0,n.KO)(x.l),[r,t]=s.useReducer((e=>!e),!1),[c,u]=s.useState(""),{navigate:d}=(0,b.Z)(),{refreshProfile:v}=(0,o.Un)(),{delegationIdentity:m}=i.fD.get(),f=s.useCallback((()=>d(`${g.Cb.base}/${g.Cb.credentials}`)),[d]);s.useEffect((()=>{e||f()}),[f,e]);const y=s.useCallback((async e=>{t();const r=await i.im.verify_token(e).catch((e=>{throw new Error(`handleSubmitSMSToken im.verify_token: ${e.message}`)}));if(t(),r.status_code>=200&&r.status_code<400)return v(),f();r.error.length&&u(r.error[0])}),[f,v]),C=s.useCallback((async()=>{if(!m)throw new Error("User delegation is undefined");try{u(""),await(0,l.V)(e,m)}catch(r){console.log({e:r}),r.message?u(r.message):(a.Am.error("We were not able to resend code. Please try again"),f())}}),[m,f,e]);return(0,p.jsx)(h,{phone:e,onSubmit:y,isLoading:r,responseError:c,onResendCode:C,resetResponseError:()=>u("")})}},1435:(e,r,t)=>{t.d(r,{l:()=>n});const n=(0,t(59794).cn)(null)},95063:(e,r,t)=>{t.d(r,{V:()=>l});var n=t(46829),s=t(33896),a=t(71520),o=(t(46647),t(30935),t(78765)),i=t(15698);if(!VERIFY_PHONE_NUMBER)throw new Error("Phone verification lambda is not defined.");async function l(e,r){const t=o.ic.isLocal?"/verify":VERIFY_PHONE_NUMBER,l=e.replace(/\s/g,""),c={methodName:"validate_signature",arg:s.xO.encode([s.xO.Opt(s.xO.Text)],[[l]])},u=await(0,i.G)(r,IDENTITY_MANAGER_CANISTER_ID,c);let d=n.Cbor.encode(u.body),v=(0,a.zv)(d);const m=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:v})});if(console.debug("verifyPhoneNumber",{phoneNumber:e,fields:c,canister:IDENTITY_MANAGER_CANISTER_ID,response:m,principal:r.getPrincipal().toText()}),!m.ok){const e=await m.json().then((e=>e));throw console.log({errorObject:e}),Error(e.error)}return(await m.json()).phoneNumberEncrypted}},15698:(e,r,t)=>{t.d(r,{G:()=>a});var n=t(46829),s=t(13791);async function a(e,r,t){const a="string"===typeof r?s.Principal.fromText(r):r,o=e.getPrincipal(),i={request_type:"query",canister_id:a,method_name:t.methodName,arg:t.arg,sender:o,ingress_expiry:new n.Expiry(3e5)};return await e.transformRequest({request:{method:"POST",headers:Object.assign({"Content-Type":"application/cbor"})},endpoint:"query",body:i})}},27016:(e,r,t)=>{t.d(r,{Y:()=>c});var n=t(18414),s=t(87273),a=t(84463),o=t(82898),i=t(74912),l=t(33693);const c=e=>{var r,t;let{className:c,onSubmit:u,errorClasses:d,responseError:v,resetResponseError:m,buttonText:f,buttonClassName:p}=e;const[h,b]=s.useState(!1),g=Array.from(Array(6).keys()),x=s.useRef([]),{formState:{errors:y},setError:C,clearErrors:E,getFieldState:N}=(0,a.cI)({mode:"all"}),j=s.useCallback((()=>x.current.map((e=>null===e||void 0===e?void 0:e.value)).join("")),[N("verificationCode")]),k=s.useCallback((e=>{if("Backspace"===e.key||"Delete"===e.key){var r;const e=document.activeElement,n=Number(null===e||void 0===e?void 0:e.getAttribute("data-pin-index"));var t;if(n&&(null===(r=x.current[n])||void 0===r||!r.value))null===(t=x.current[n-1])||void 0===t||t.focus()}}),[]),w=s.useCallback((e=>{var r;const t=null===(r=e.clipboardData)||void 0===r?void 0:r.getData("text/plain");t&&(0,o.wu)(t)&&(x.current.forEach(((e,r)=>{var n;e&&(e.value=t[r],null===(n=x.current[r])||void 0===n||n.blur())})),E("verificationCode"))}),[E]),S=s.useCallback((()=>{E("verificationCode"),b(6===j().length)}),[E,j]);s.useEffect((()=>(document.addEventListener("paste",w),document.addEventListener("keydown",k),()=>{document.removeEventListener("paste",w)})),[k,w]),s.useEffect((()=>{null!==v&&void 0!==v&&v.length?C("verificationCode",{type:"manual",message:v}):S()}),[S,v,C]);const R=s.useCallback((()=>{h&&u(j())}),[j,h,u]);return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{id:"pin-input",className:(0,n.Z)("flex space-x-3",c),children:g.map(((e,r)=>{var t,n;return(0,l.jsx)(o.II,{id:`pin-input-${r}`,pin:!0,type:"number",autoFocus:0===r,"data-pin-index":r,ref:e=>x.current[r]=e,onChange:e=>((e,r)=>{var t;if(m&&null!==v&&void 0!==v&&v.length&&(m(),E("verificationCode")),null===(t=x.current[r])||void 0===t?void 0:t.value.match(e.target.pattern)){var n,s;r===g.length-1&&(null===(s=x.current[r])||void 0===s||s.blur()),null===(n=x.current[r+1])||void 0===n||n.focus()}else e.target.value=e.target.value[0];b(6===j().length)})(e,r),maxLength:1,pattern:"^[0-9]{1}$",isErrorStyles:!(null===(t=y.verificationCode)||void 0===t||null===(n=t.message)||void 0===n||!n.length)},r)}))}),(0,l.jsx)("div",{id:"pin-input-error",className:(0,n.Z)("py-1 text-sm text-red-base",d),children:(null===(r=y.verificationCode)||void 0===r?void 0:r.message)||(null===(t=y.phonenumber)||void 0===t?void 0:t.message)}),(0,l.jsx)(i.z,{id:"send-pin",primary:!0,className:(0,n.Z)("px-10 mt-3 sm:mt-5",p),onClick:()=>{(()=>{const e=j();e.length!==o.PH.minLength?C("verificationCode",{type:"manual",message:o.PH.errorMessages.length}):(0,o.wu)(e)?E("verificationCode"):C("verificationCode",{type:"manual",message:o.PH.errorMessages.pattern})})(),R()},disabled:!h,children:f})]})}},47200:(e,r,t)=>{t.d(r,{Z:()=>a});var n=t(18414),s=(t(87273),t(33693));const a=e=>{let{title:r,subTitle:t,children:a,className:o,showChildrenPadding:i=!0,id:l}=e;return(0,s.jsxs)("div",{id:l,className:(0,n.Z)("block border border-gray-200 rounded-xl","py-4 sm:py-[26px]",o),children:[(0,s.jsxs)("div",{className:"px-5",children:[r&&(0,s.jsx)("div",{className:"flex items-center justify-between mb-3 text-xl",children:r}),t&&(0,s.jsx)("div",{className:"flex items-center justify-between mb-4 text-sm leading-5 text-secondary",children:t})]}),(0,s.jsx)("div",{className:(0,n.Z)(i&&"px-5 sm:px-[30px]"),children:a})]})}},27221:(e,r,t)=>{t.d(r,{J:()=>s});var n=t(87273);const s=e=>{let{defaultCounter:r,loop:t,frequency:s=1e3,onElapsed:a}=e;const[o,i]=n.useState(r),l=n.useRef(),[c,u]=n.useState(!1),d=n.useCallback((()=>{o>0&&i(o-1),0===o&&(u(!0),a&&a(),clearInterval(Number(l.current))),0===o&&t&&(i(r),l.current=setInterval(d,s),u(!1))}),[o,r,s,t,a]);return n.useEffect((()=>(l.current=setInterval(d,s),()=>clearInterval(Number(l.current)))),[s,d]),{elapsed:c,setCounter:i,counter:o}}},55081:(e,r,t)=>{t.d(r,{L:()=>c});var n=t(87273),s=t(68682),a=t(49371),o=t(98740);function i(e){return"deferred"in e}function l(e){return"getSnapshot"in e?e.getSnapshot():function(e){return"state"in e}(e)?e.state:void 0}function c(e,r){void 0===r&&(r=l);var t=(0,n.useRef)(e),c=(0,n.useRef)([]),u=(0,n.useCallback)((function(r){return e.subscribe(r).unsubscribe}),[e]),d=(0,n.useCallback)((function(){return r(e)}),[e,r]),v=(0,o.useSyncExternalStore)(u,d,d),m=(0,a.Z)((function(){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=e[0];var s=t.current;i(s)&&s.deferred?c.current.push(n):s.send(n)}}));return(0,s.Z)((function(){for(t.current=e;c.current.length>0;){var r=c.current.shift();e.send(r)}}),[e]),[v,m]}}}]);
//# sourceMappingURL=334.a87013ce.chunk.js.map