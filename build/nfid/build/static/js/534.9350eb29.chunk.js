"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[534],{24936:(e,s,t)=>{t.d(s,{z:()=>r});var a=t(18414),l=(t(87273),t(82898)),i=t(33693);const r=e=>{let{actionButtons:s,onInputChange:t,onInputType:r}=e;return(0,i.jsxs)("div",{className:(0,a.Z)("flex items-center justify-between","bg-gray-50 p-5 rounded-t-xl sm:rounded-b-md"),children:[(0,i.jsx)(l.II,{placeholder:"Search",icon:(0,i.jsx)(l.MN,{className:"w-4"}),onChange:t,onKeyDown:r,className:"sm:w-[350px]"}),s]})}},23370:(e,s,t)=>{t.d(s,{f:()=>n});var a=t(54915),l=t(87273),i=t(69491),r=t(33492);const n=()=>{const{profile:e}=(0,i.Un)(),{data:s,isLoading:t,isValidating:n}=(0,r.I)(null===e||void 0===e?void 0:e.anchor);return{address:(0,l.useMemo)((()=>s?(0,a.PZ)(s.getPrincipal(),Array(32).fill(1)):""),[s]),anchor:null===e||void 0===e?void 0:e.anchor,identity:s,isLoading:n,isReady:!t}}},47534:(e,s,t)=>{t.r(s),t.d(s,{VaultsDetailsCoordinator:()=>re,default:()=>ne});var a=t(87273),l=t(82898),i=t(72565),r=t(95163),n=t(94244),o=t(78765);var d=t(23370);const c=()=>{const{vaultId:e}=(0,r.UO)(),{address:s}=(0,d.f)(),{data:t,isLoading:l,isValidating:i,mutate:c}=(0,n.ZP)(e?`vault_${e}`:null,(()=>(async e=>(await(0,o._w)()).find((s=>s.id===BigInt(e))))(null!==e&&void 0!==e?e:""))),u=(0,a.useMemo)((()=>{const e=null===t||void 0===t?void 0:t.members.find((e=>e.userId===s));return(null===e||void 0===e?void 0:e.role)===o.Oz.ADMIN}),[s,null===t||void 0===t?void 0:t.members]);return{isFetching:l||i,refetch:c,vault:t,isAdmin:u}};var u=t(24936),m=t(18414),v=t(84463),h=t(96349),x=t(33693);const p=()=>{var e,s;const[t,i]=(0,a.useState)(!1),[r,n]=(0,a.useState)(!1),{vault:u,refetch:p}=c(),{address:j}=(0,d.f)(),{register:g,handleSubmit:b,formState:y,resetField:f,reset:w}=(0,v.cI)({defaultValues:{name:"",address:""}});return(0,x.jsx)(l.TK,{large:!0,title:"Add member",isLoading:t,isModalOpen:r,isModalOpenChange:n,secondaryButton:{type:"stroke",text:"Cancel"},primaryButton:{type:"primary",onClick:b((async e=>{let{name:s,address:t}=e;if(null!==u&&void 0!==u&&u.id){if(t===j)return h.Am.warn("You're trying to invite yourself to the vault. Try another address."),n(!1),f("address");try{i(!0),await(0,o.ff)({memberAddress:t,name:s,vaultId:null===u||void 0===u?void 0:u.id,role:o.Oz.MEMBER,state:o.Q$.ACTIVE}),h.Am.success(`Member ${s} successfully added`),w()}catch(a){h.Am.error(a.message)}finally{i(!1),n(!1),await p()}}})),text:"Add",id:"add-member-button"},trigger:(0,x.jsxs)("div",{className:(0,m.Z)("flex items-center space-x-2 font-bold text-blue-600 cursor-pointer","hover:opacity-50 transition-opacity"),id:"add-member-trigger",children:[(0,x.jsx)(l.Ji,{className:"w-4"}),(0,x.jsx)("span",{className:"hidden text-sm sm:block",children:"Add member"})]}),children:(0,x.jsxs)("div",{className:"space-y-5",children:[(0,x.jsx)(l.II,{labelText:"Name",errorText:null===(e=y.errors.name)||void 0===e?void 0:e.message,...g("name",{required:"This field cannot be empty"})}),(0,x.jsx)(l.II,{labelText:"NFID address",errorText:null===(s=y.errors.address)||void 0===s?void 0:s.message,...g("address",{required:"This field cannot be empty"})})]})})},j=e=>{let{isModalOpen:s,setIsModalOpen:t,selectedMember:i}=e;const[r,n]=(0,a.useState)(!1),{vault:d,refetch:u}=c(),v=(0,a.useCallback)((async()=>{if(i&&null!==d&&void 0!==d&&d.id)try{var e;n(!0),await(0,o.ff)({...i,vaultId:BigInt(d.id),memberAddress:i.userId,name:null!==(e=i.name)&&void 0!==e?e:"",state:o.Q$.ARCHIVED})}catch(s){h.Am.error(s.message)}finally{n(!1),t(!1),h.Am.success("Vault member archived"),await u()}}),[u,i,t,null===d||void 0===d?void 0:d.id]);return(0,x.jsx)(l.TK,{large:!0,title:"Archive member",isLoading:r,isModalOpen:s,isModalOpenChange:t,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"red",text:"Archive",onClick:v},children:(0,x.jsxs)("div",{className:"flex items-start gap-5",children:[(0,x.jsx)("div",{className:(0,m.Z)("w-16 h-16 flex items-center justify-center shrink-0","bg-gradient-to-br from-red-50 to-white rounded-3xl"),children:(0,x.jsx)(l.T2,{className:"text-red-500 w-7"})}),(0,x.jsxs)("p",{className:"text-sm",children:["This member will be excluded from this vault, and any pending transactions requiring their approval will need to be resubmitted.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"Archive ",(0,x.jsx)("strong",{children:null===i||void 0===i?void 0:i.name}),"?"]})]})})},g=e=>{var s;let{isModalOpen:t,setIsModalOpen:i,selectedMember:r}=e;const[n,d]=(0,a.useState)(!1),{vault:u,refetch:m}=c(),{register:p,handleSubmit:j,formState:g,reset:b}=(0,v.cI)({defaultValues:(0,a.useMemo)((()=>({name:null===r||void 0===r?void 0:r.name,userId:null===r||void 0===r?void 0:r.userId})),[null===r||void 0===r?void 0:r.name,null===r||void 0===r?void 0:r.userId])});(0,a.useEffect)((()=>{b(r)}),[b,r]);const y=(0,a.useCallback)((async e=>{if(r&&null!==u&&void 0!==u&&u.id)try{var s;d(!0),await(0,o.ff)({...r,vaultId:BigInt(u.id),memberAddress:r.userId,name:null!==(s=e.name)&&void 0!==s?s:""})}catch(t){h.Am.error(t.message)}finally{d(!1),i(!1),h.Am.success("Vault member updated"),await m()}}),[m,r,i,null===u||void 0===u?void 0:u.id]);return(0,x.jsxs)(l.TK,{large:!0,title:"Edit member",isLoading:n,isModalOpen:t,isModalOpenChange:i,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"primary",onClick:j(y),text:"Save"},children:[(0,x.jsx)(l.II,{labelText:"Name",errorText:null===(s=g.errors.name)||void 0===s?void 0:s.message,...p("name",{required:"First name must not be blank"})}),(0,x.jsx)(l.II,{disabled:!0,labelText:"NFID address",...p("userId")})]})},b=()=>(0,x.jsxs)(l.SC,{header:!0,children:[(0,x.jsx)(l.pj,{isLeft:!0,className:"w-10",children:"#"}),(0,x.jsx)(l.pj,{isLeft:!0,className:"w-auto",children:"Name"}),(0,x.jsx)(l.pj,{centered:!0,className:"w-32",children:"NFID address"}),(0,x.jsx)(l.pj,{centered:!0,className:"w-32",children:"Role"}),(0,x.jsx)(l.pj,{isRight:!0,className:"w-10"})]});var y=t(76058);const f=e=>{let{name:s,address:t,role:a,index:i,onEdit:r,onArchive:n,isArchived:o,isAdmin:d}=e;return(0,x.jsxs)(l.SC,{className:(0,m.Z)(o&&"text-secondary pointer-events-none"),id:`member_${s}`,children:[(0,x.jsx)(l.pj,{isLeft:!0,children:i}),(0,x.jsx)(l.pj,{children:s}),(0,x.jsx)(l.pj,{centered:!0,children:(0,x.jsx)(y.M,{value:t,leadingChars:9,trailingChars:3})}),(0,x.jsx)(l.pj,{centered:!0,children:a}),(0,x.jsx)(l.pj,{isRight:!0,className:"px-0",children:(0,x.jsx)(l.J2,{align:"end",trigger:(0,x.jsx)(l.K_,{className:(0,m.Z)("w-full",(o||!d)&&"hidden")}),children:(0,x.jsx)(l.KN,{items:[{icon:(0,x.jsx)(l.c,{}),text:"Edit",onClick:r},{icon:(0,x.jsx)(l.T2,{}),text:"Archive",onClick:n}]})})})]})},w=e=>{let{members:s}=e;const[t,i]=(0,a.useState)(!1),[r,n]=(0,a.useState)(!1),[d,u]=(0,a.useState)(),{isAdmin:m}=c(),v=(0,a.useMemo)((()=>s.map(((e,s)=>{var t;return{name:null!==(t=e.name)&&void 0!==t?t:"Unknown user",address:e.userId,role:e.role,index:s+1,isArchived:e.state===o.Q$.ARCHIVED,isAdmin:m}}))),[m,s]),h=(0,a.useCallback)(((e,t)=>{const a=s.find((e=>e.userId===t));u(a),"edit"===e&&i(!0),"archive"===e&&n(!0)}),[s]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(l.iA,{tableHeader:(0,x.jsx)(b,{}),children:v.map((e=>(0,a.createElement)(f,{...e,key:`vault_${e.address}`,onEdit:()=>h("edit",e.address),onArchive:()=>h("archive",e.address)})))}),(0,x.jsx)(g,{isModalOpen:t,setIsModalOpen:i,selectedMember:d}),(0,x.jsx)(j,{selectedMember:d,isModalOpen:r,setIsModalOpen:n})]})},N=()=>{const[e,s]=(0,a.useState)(""),{vault:t,isFetching:i,isAdmin:r}=c(),n=(0,a.useMemo)((()=>null!==t&&void 0!==t&&t.members?null===t||void 0===t?void 0:t.members.filter((s=>{var t;return!s.name||(null===(t=s.name)||void 0===t?void 0:t.includes(e))})).sort(((e,s)=>e.state.localeCompare(s.state))).sort(((e,s)=>e.role.localeCompare(s.role))):[]),[e,null===t||void 0===t?void 0:t.members]),o=(0,a.useCallback)((e=>{s(e.target.value)}),[]);return(0,x.jsxs)("div",{className:"border border-gray-200 rounded-xl mt-[30px]",children:[(0,x.jsx)(u.z,{onInputChange:o,actionButtons:r?(0,x.jsx)(p,{}):(0,x.jsx)("div",{})}),(0,x.jsxs)("div",{className:"w-full px-5 overflow-x-auto",children:[(0,x.jsx)(w,{members:n}),!n.length&&!i&&(0,x.jsx)(l.Sn,{className:"h-64",icon:(0,x.jsx)(l.oU,{}),description:"Add and manage team member permissions and roles."})]})]})};var I=t(94159);const C=()=>{const{vaultId:e}=(0,r.UO)(),{data:s,isLoading:t,isValidating:a,mutate:l}=(0,n.ZP)(e?`vault_${e}_wallets`:null,(()=>(0,o.MX)(BigInt(null!==e&&void 0!==e?e:"")))),{data:i,isValidating:d}=(0,n.ZP)(s?[s,"useVaultWallets"]:null,(async e=>{let[s]=e;return console.debug("useVaultWallets",{wallets:s}),await(0,I.SP)(s)}),{dedupingInterval:3e4,refreshInterval:6e4});return{vaultId:e,isFetching:t||a||d,refetch:l,wallets:i}},A=()=>{const{vaultId:e}=(0,r.UO)(),{wallets:s}=C(),{data:t,isLoading:l,isValidating:i,mutate:d}=(0,n.ZP)(e?`vault_${e}_policies`:null,(()=>(0,o.Ko)(BigInt(null!==e&&void 0!==e?e:"")))),c=(0,a.useMemo)((()=>null===t||void 0===t?void 0:t.map((e=>{var t;return{...e,walletName:e.wallets?null===s||void 0===s||null===(t=s.find((s=>s.uid===(e.wallets&&e.wallets[0]))))||void 0===t?void 0:t.name:"Any"}}))),[t,s]);return{vaultId:e,isFetching:l||i,refetch:d,policies:c}},T=()=>(0,x.jsx)(l.u,{tip:(0,x.jsxs)("ul",{className:"text-xs max-w-[360px] list-disc leading-4 space-y-1",children:[(0,x.jsx)("li",{children:"Individual wallet policies take precedent over policies applied to all wallets."}),(0,x.jsx)("li",{children:"If a wallet (or Any source) has one or more policies available, a transaction will trigger the policy with the highest value first and approver threshold next."}),(0,x.jsx)("li",{children:"Make sure no gaps exist in your policy workflows."}),(0,x.jsx)("li",{children:"Known shortcomings: Policies can have more approvers than members in a vault."})]}),className:"!px-3",children:(0,x.jsx)(l.Ek,{className:"text-secondary cursor-pointer"})});var S=t(94480),k=t(51921);const M=()=>{var e,s;const[t,i]=(0,a.useState)([]),[r,n]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!1),{refetch:p}=A(),{wallets:j}=C(),{vault:g}=c(),b=(0,a.useMemo)((()=>{const e=null===j||void 0===j?void 0:j.map((e=>{var s,t;return{label:null!==(s=e.name)&&void 0!==s?s:"",value:null!==(t=e.uid)&&void 0!==t?t:"",disabled:e.state===o.Q$.ARCHIVED}}));return null===e||void 0===e||e.unshift({label:"Any",value:"Any",disabled:!1}),e}),[j]),{register:y,handleSubmit:f,formState:w,reset:N}=(0,v.cI)({defaultValues:{amount:0,approvers:0}});return(0,x.jsx)(l.TK,{large:!0,title:"Add policy",isLoading:r,isModalOpen:d,isModalOpenChange:u,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"primary",onClick:f((async e=>{let{amount:s,approvers:a}=e;if(null!==g&&void 0!==g&&g.id)try{n(!0),await(0,o.DX)({vaultId:null===g||void 0===g?void 0:g.id,amountThreshold:BigInt((0,k.Q)(String(s))),currency:o.F.ICP,memberThreshold:Number(a),type:o.Mi.THRESHOLD_POLICY,wallets:"Any"===t[0]?void 0:t}),N()}catch(l){console.log({e:l}),h.Am.error(l.message)}finally{n(!1),u(!1),h.Am.success("Policy successfully added"),await p()}})),text:"Add",id:"create-policy-button"},trigger:(0,x.jsxs)("div",{className:(0,m.Z)("flex items-center space-x-2 font-bold text-blue-600 cursor-pointer","hover:opacity-50 transition-opacity"),id:"create-policy-trigger",children:[(0,x.jsx)(l.Ji,{className:"w-4"}),(0,x.jsx)("span",{className:"hidden text-sm sm:block",children:"Add policy"})]}),children:(0,x.jsxs)("div",{className:"space-y-5",id:"create-policy-modal",children:[(0,x.jsx)(l.TV,{label:"Source (transactions sourced from this wallet)",options:null!==b&&void 0!==b?b:[],selectedValues:t,setSelectedValues:i,isMultiselect:!1,placeholder:"Select wallet",id:"select-wallet"}),(0,x.jsxs)("div",{className:"grid grid-cols-2 gap-5",children:[(0,x.jsx)(l.II,{labelText:"Greater than (that are greater than)",type:"number",innerText:"ICP",errorText:null===(e=w.errors.amount)||void 0===e?void 0:e.message,...y("amount",{required:"This field cannot be empty"})}),(0,x.jsx)(l.II,{labelText:"Approvers",type:"number",innerText:`of ${null===g||void 0===g?void 0:g.members.length}`,errorText:null===(s=w.errors.approvers)||void 0===s?void 0:s.message,...y("approvers",{required:"This field cannot be empty",validate:(0,S._)({min:1,max:255,toLowError:"Minimum amount is 1",toBigError:"Maximum amount is 255"})})})]})]})})},O=e=>{let{isModalOpen:s,setIsModalOpen:t,selectedPolicy:i}=e;const[r,n]=(0,a.useState)(!1),{refetch:d}=A(),c=(0,a.useCallback)((async()=>{if(i)try{n(!0),await(0,o.i5)({...i,state:o.Q$.ARCHIVED})}catch(e){h.Am.error(e.message)}finally{n(!1),t(!1),h.Am.success("Policy archived"),await d()}}),[d,i,t]);return(0,x.jsx)(l.TK,{large:!0,title:"Archive wallet",isLoading:r,isModalOpen:s,isModalOpenChange:t,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"red",text:"Archive",onClick:c},children:(0,x.jsxs)("div",{className:"flex items-start gap-5",children:[(0,x.jsx)("div",{className:(0,m.Z)("w-16 h-16 flex items-center justify-center shrink-0","bg-gradient-to-br from-red-50 to-white rounded-3xl"),children:(0,x.jsx)(l.T2,{className:"text-red-500 w-7"})}),(0,x.jsxs)("p",{className:"text-sm",children:["This wallet, along with its policies and transactions, will be excluded from your Vault pages.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"Archive policy?"]})]})})},E=e=>{var s,t;let{isModalOpen:i,setIsModalOpen:r,selectedPolicy:n}=e;const[d,u]=(0,a.useState)(!1),{refetch:m}=A(),{vault:p}=c(),{register:j,handleSubmit:g,formState:b,reset:y}=(0,v.cI)({defaultValues:(0,a.useMemo)((()=>({amount:Number(null===n||void 0===n?void 0:n.amountThreshold),approvers:Number(null===n||void 0===n?void 0:n.memberThreshold),wallet:String(null!==n&&void 0!==n&&n.wallets?n.wallets[0]:"Any")})),[null===n||void 0===n?void 0:n.amountThreshold,null===n||void 0===n?void 0:n.memberThreshold,null===n||void 0===n?void 0:n.wallets])});(0,a.useEffect)((()=>{y({amount:Number(null===n||void 0===n?void 0:n.amountThreshold),approvers:Number(null===n||void 0===n?void 0:n.memberThreshold),wallet:String(null!==n&&void 0!==n&&n.wallets?n.wallets[0]:"Any")})}),[y,n]);const f=(0,a.useCallback)((async e=>{if(n)try{u(!0),await(0,o.i5)({...n,amountThreshold:BigInt(e.amount),memberThreshold:Number(e.approvers)})}catch(s){h.Am.error(s.message)}finally{u(!1),r(!1),h.Am.success("Vault policy updated"),await m()}}),[m,n,r]);return(0,x.jsx)(l.TK,{large:!0,title:"Edit policy",isLoading:d,isModalOpen:i,isModalOpenChange:r,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"primary",onClick:g(f),text:"Save"},children:(0,x.jsxs)("div",{className:"space-y-5",children:[(0,x.jsx)(l.II,{disabled:!0,labelText:"Transactions sourced from this wallet",...j("wallet")}),(0,x.jsx)(l.II,{labelText:"That are greater than",type:"number",innerText:"ICP",errorText:null===(s=b.errors.amount)||void 0===s?void 0:s.message,...j("amount",{required:"This field cannot be empty"})}),(0,x.jsx)(l.II,{labelText:"Will require this number of approvers",type:"number",innerText:`of ${null===p||void 0===p?void 0:p.members.length}`,errorText:null===(t=b.errors.approvers)||void 0===t?void 0:t.message,...j("approvers",{required:"This field cannot be empty",validate:(0,S._)({min:1,max:255,toLowError:"Minimum amount is 1",toBigError:"Maximum amount is 255"})})})]})})},B=()=>(0,x.jsxs)(l.SC,{header:!0,children:[(0,x.jsx)(l.pj,{isLeft:!0,className:"w-2",children:"#"}),(0,x.jsx)(l.pj,{className:"w-auto",children:"Source"}),(0,x.jsx)(l.pj,{className:"w-44",children:"Greater than"}),(0,x.jsx)(l.pj,{centered:!0,className:"w-44",children:"Approvers"}),(0,x.jsx)(l.pj,{isRight:!0,className:"w-10"})]}),_=e=>{let{number:s,source:t,greaterThan:a,approvers:i,onArchive:r,onEdit:n,isArchived:o,isAdmin:d}=e;return(0,x.jsxs)(l.SC,{className:(0,m.Z)(o&&"text-secondary pointer-events-none"),id:"policy_row",children:[(0,x.jsx)(l.pj,{isLeft:!0,children:s}),(0,x.jsx)(l.pj,{children:t}),(0,x.jsx)(l.pj,{children:a}),(0,x.jsx)(l.pj,{centered:!0,children:i}),(0,x.jsx)(l.pj,{isRight:!0,className:"px-0",children:(0,x.jsx)(l.J2,{align:"end",trigger:(0,x.jsx)(l.K_,{className:(0,m.Z)("w-full",(o||!d)&&"hidden")}),children:(0,x.jsx)(l.KN,{items:[{icon:(0,x.jsx)(l.c,{}),text:"Edit",onClick:n},{icon:(0,x.jsx)(l.T2,{}),text:"Archive",onClick:r}]})})})]})},V=e=>{let{policies:s}=e;const[t,i]=(0,a.useState)(!1),[r,n]=(0,a.useState)(!1),[d,u]=(0,a.useState)(),{vault:m,isAdmin:v}=c(),h=(0,a.useMemo)((()=>s.map(((e,s)=>({id:e.id,number:s+1,source:e.walletName,greaterThan:`${(0,k.e)(Number(e.amountThreshold))} ${e.currency}`,approvers:e.memberThreshold?`${e.memberThreshold} of ${null===m||void 0===m?void 0:m.members.length}`:"All",isArchived:e.state===o.Q$.ARCHIVED,isAdmin:v})))),[v,s,null===m||void 0===m?void 0:m.members.length]),p=(0,a.useCallback)(((e,t)=>{const a=s.find((e=>e.id===BigInt(t)));u(a),"archive"===e&&i(!0),"edit"===e&&n(!0)}),[s]);return(0,x.jsxs)(l.iA,{tableHeader:(0,x.jsx)(B,{}),children:[h.map((e=>(0,a.createElement)(_,{...e,key:`policy_${e.id}`,onArchive:()=>{var s;return p("archive",null!==(s=String(e.id))&&void 0!==s?s:"")},onEdit:()=>{var s;return p("edit",null!==(s=String(e.id))&&void 0!==s?s:"")},isArchived:e.isArchived}))),(0,x.jsx)(O,{selectedPolicy:d,isModalOpen:t,setIsModalOpen:i}),(0,x.jsx)(E,{selectedPolicy:d,isModalOpen:r,setIsModalOpen:n})]})},D=()=>{const[e,s]=(0,a.useState)(""),{policies:t,isFetching:i}=A(),{isAdmin:r}=c(),n=(0,a.useMemo)((()=>t?t.filter((s=>{var t;return null===s||void 0===s||null===(t=s.walletName)||void 0===t?void 0:t.includes(e)})).sort(((e,s)=>Number(e.createdDate)-Number(s.createdDate))):[]),[t,e]),o=(0,a.useCallback)((e=>{s(e.target.value)}),[]);return(0,x.jsxs)("div",{className:"border border-gray-200 rounded-xl mt-[30px]",children:[(0,x.jsx)(u.z,{onInputChange:o,actionButtons:(0,x.jsxs)("div",{className:"flex space-x-5",children:[r?(0,x.jsx)(M,{}):null,(0,x.jsx)(T,{})]})}),(0,x.jsxs)("div",{className:"w-full px-5 overflow-x-auto",children:[(0,x.jsx)(V,{policies:n}),!n.length&&!i&&(0,x.jsx)(l.Sn,{className:"h-64",icon:(0,x.jsx)(l.Ux,{}),description:"Manage the policies for wallets in your vault."})]})]})};var L=t(35826);const F=e=>{let{initiatorsOptions:s,statusOptions:t,initiatedFilter:a,setInitiatedFilter:i,statusFilter:r,setStatusFilter:n,timeFilter:o,setTimeFilter:d,onResetFilters:c,onApplyFilters:u}=e;return(0,x.jsx)(l.EZ,{onReset:c,onApply:u,trigger:(0,x.jsx)(l.Z_,{className:"transition-opacity cursor-pointer hover:opacity-60"}),align:"end",children:(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsx)(l.II,{type:"date",labelText:"From",onChange:e=>d({...o,from:e.target.value}),value:o.from}),(0,x.jsx)("div",{className:"w-1 h-[1px] block bg-black shrink-0 mt-6"}),(0,x.jsx)(l.II,{type:"date",labelText:"To",onChange:e=>d({...o,to:e.target.value}),value:o.to})]}),(0,x.jsx)(l.TV,{options:s,selectedValues:a,setSelectedValues:i,label:"Initiated"}),(0,x.jsx)(l.TV,{options:t,selectedValues:r,setSelectedValues:n,label:"Status"})]})})};var P=t(13791),R=t(3209),Z=t(54915),$=t(75557),U=t(42809);const H=()=>(0,x.jsxs)(l.SC,{header:!0,children:[(0,x.jsx)(l.pj,{isLeft:!0,className:"w-2",children:"#"}),(0,x.jsx)(l.pj,{className:"w-auto",children:"Initiated"}),(0,x.jsx)(l.pj,{className:"w-32",children:"From"}),(0,x.jsx)(l.pj,{className:"w-32",children:"To"}),(0,x.jsx)(l.pj,{className:"w-36",children:"Tokens"}),(0,x.jsx)(l.pj,{className:"w-36",children:"Status"}),(0,x.jsx)(l.pj,{isRight:!0,className:"w-10"})]});var K=t(45482);const W=e=>{let{transactions:s}=e;const{vault:t}=c(),{wallets:i}=C(),{exchangeRate:r}=(0,U.G)(),{address:n}=(0,d.f)(),o=(0,a.useMemo)((()=>(console.log({transactions:s}),s.map(((e,s)=>{var a,l;return{number:s+1,fromWalletName:null!==(a=null===i||void 0===i||null===(l=i.find((s=>s.uid===e.from_sub_account)))||void 0===l?void 0:l.name)&&void 0!==a?a:"",toAddress:e.to,ownerName:e.owner,id:e.id,status:e.state,amountICP:(0,k.e)(Number(e.amount)),amountUSD:(0,$.tF)(Number((0,k.e)(Number(e.amount))),null!==r&&void 0!==r?r:0),fromAddress:(0,Z.PZ)(P.Principal.fromText(VAULT_CANISTER_ID),(0,Z.Wu)(e.from_sub_account)),createdDate:(0,R.Z)(new Date((0,L.Jv)(e.createdDate)),"MMM dd, yyyy - hh:mm:ss aaa"),approvers:null===t||void 0===t?void 0:t.members.map((s=>({name:s.name,isApproved:-1!==e.approves.findIndex((e=>e.signer===s.userId))}))).sort(((e,s)=>Number(s.isApproved)-Number(e.isApproved))),memberThreshold:e.memberThreshold,isInitiatedByYou:e.owner===n,isApprovedByYou:-1!==e.approves.findIndex((e=>e.signer===n)),memo:e.memo}})))),[r,s,n,null===t||void 0===t?void 0:t.members,i]);return(0,x.jsx)(l.iA,{tableHeader:(0,x.jsx)(H,{}),children:o.map((e=>(0,a.createElement)(K._,{...e,key:`transaction_${e.id}`})))})},G={from:"",to:""},J=()=>{const[e,s]=(0,a.useState)(""),[t,i]=(0,a.useState)([]),[d,m]=(0,a.useState)([]),[v,h]=(0,a.useState)(G),{transactions:p,isFetching:j}=(()=>{const{vaultId:e}=(0,r.UO)(),{data:s,isLoading:t,isValidating:l,mutate:i}=(0,n.ZP)(e?`vault_${e}_transactions`:null,(()=>(0,o.HL)())),d=(0,a.useMemo)((()=>null===s||void 0===s?void 0:s.filter((s=>s.vaultId===BigInt(null!==e&&void 0!==e?e:0)))),[s,e]);return{allTransactions:s,isFetching:t||l,refetch:i,transactions:d}})(),{vault:g}=c(),b=(0,a.useMemo)((()=>{var e;return null!==(e=null===g||void 0===g?void 0:g.members.map((e=>{var s;return{label:null!==(s=e.name)&&void 0!==s?s:"Unknown user",value:e.userId}})))&&void 0!==e?e:[]}),[null===g||void 0===g?void 0:g.members]),y=(0,a.useMemo)((()=>Object.values(o.g7).map((e=>({label:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase(),value:e})))),[]),f=(0,a.useCallback)((()=>{m([]),i([]),h(G)}),[]),w=(0,a.useMemo)((()=>p?p.map((e=>{var s,t;return{...e,owner:null!==(s=null===g||void 0===g||null===(t=g.members.find((s=>s.userId===e.owner)))||void 0===t?void 0:t.name)&&void 0!==s?s:e.owner}})).filter((s=>null===s||void 0===s?void 0:s.owner.includes(e))).filter((e=>!d.length||d.includes(e.state))).filter((e=>!t.length||t.includes(e.owner))).filter((e=>v.from.length||v.to.length?(0,L.zx)(new Date((0,L.Jv)(e.createdDate)),v.from.length?new Date(v.from):void 0,v.to.length?new Date(v.to):void 0):e)):[]),[p,null===g||void 0===g?void 0:g.members,e,d,t,v.from,v.to]),N=(0,a.useCallback)((e=>{s(e.target.value)}),[]);return(0,x.jsxs)("div",{className:"border border-gray-200 rounded-xl mt-[30px]",children:[(0,x.jsx)(u.z,{onInputChange:N,actionButtons:(0,x.jsxs)("div",{className:"flex items-center justify-end w-full ml-4 space-x-5",children:[(0,x.jsx)(F,{initiatorsOptions:b,statusOptions:y,initiatedFilter:t,setInitiatedFilter:e=>i(e),statusFilter:d,setStatusFilter:e=>m(e),timeFilter:v,setTimeFilter:h,onResetFilters:f}),(0,x.jsx)(l.fV,{className:"transition-opacity cursor-pointer hover:opacity-60"})]})}),(0,x.jsxs)("div",{className:"w-full px-5 overflow-x-auto",children:[(0,x.jsx)(W,{transactions:w}),!w.length&&!j&&(0,x.jsx)(l.Sn,{className:"h-64",icon:(0,x.jsx)(l.lA,{}),description:"No recent transactions to display."})]})]})},Q=()=>{var e;const[s,t]=(0,a.useState)(!1),[i,r]=(0,a.useState)(!1),{vaultId:n,refetch:d}=C(),{register:c,handleSubmit:u,formState:p}=(0,v.cI)({defaultValues:{name:""}});return(0,x.jsx)(l.TK,{large:!0,title:"Add wallet",isLoading:s,isModalOpen:i,isModalOpenChange:r,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"primary",onClick:u((async e=>{let{name:s}=e;if(n)try{t(!0),await(0,o.LQ)({name:s,vaultId:BigInt(n)})}catch(a){h.Am.error(a.message)}finally{t(!1),r(!1),h.Am.success(`Wallet ${s} successfully added`),await d()}})),text:"Create",id:"create-wallet-button"},trigger:(0,x.jsxs)("div",{className:(0,m.Z)("flex items-center space-x-2 font-bold text-blue-600 cursor-pointer","hover:opacity-50 transition-opacity"),id:"create-wallet-trigger",children:[(0,x.jsx)(l.Ji,{className:"w-4"}),(0,x.jsx)("span",{className:"hidden text-sm sm:block",children:"Add wallet"})]}),children:(0,x.jsx)("div",{className:"space-y-5",children:(0,x.jsx)(l.II,{labelText:"Name",errorText:null===(e=p.errors.name)||void 0===e?void 0:e.message,...c("name",{required:"This field cannot be empty"})})})})},q=e=>{let{isModalOpen:s,setIsModalOpen:t,selectedWallet:i}=e;const[r,n]=(0,a.useState)(!1),{refetch:d}=C(),c=(0,a.useCallback)((async()=>{if(i)try{n(!0),await(0,o.K8)({...i,state:o.Q$.ARCHIVED})}catch(e){h.Am.error(e.message)}finally{n(!1),t(!1),h.Am.success("Wallet archived"),await d()}}),[d,i,t]);return(0,x.jsx)(l.TK,{large:!0,title:"Archive wallet",isLoading:r,isModalOpen:s,isModalOpenChange:t,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"red",text:"Archive",onClick:c},children:(0,x.jsxs)("div",{className:"flex items-start gap-5",children:[(0,x.jsx)("div",{className:(0,m.Z)("w-16 h-16 flex items-center justify-center shrink-0","bg-gradient-to-br from-red-50 to-white rounded-3xl"),children:(0,x.jsx)(l.T2,{className:"text-red-500 w-7"})}),(0,x.jsxs)("p",{className:"text-sm",children:["This wallet, along with its policies and transactions, will be excluded from your Vault pages.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"Archive ",(0,x.jsx)("strong",{children:null===i||void 0===i?void 0:i.name}),"?"]})]})})},z=()=>(0,x.jsxs)(l.SC,{header:!0,children:[(0,x.jsx)(l.pj,{isLeft:!0,className:"w-2",children:"#"}),(0,x.jsx)(l.pj,{className:"w-auto",children:"Name"}),(0,x.jsx)(l.pj,{className:"w-44",children:"Token balance"}),(0,x.jsx)(l.pj,{className:"w-44",children:"USD balance"}),(0,x.jsx)(l.pj,{isRight:!0,className:"w-10"})]});var Y=t(55081),X=t(21650),ee=t(23210),se=t(3752);const te=e=>{let{address:s,number:t,name:i,tokenBalance:r,USDBalance:n,onArchive:o,isArchived:d,isAdmin:c}=e;const u=(0,a.useContext)(se.J),{token:v}=(0,X.O)(),[,h]=(0,Y.L)(u.transferService),{wallets:p}=(0,ee.w)(),j=(0,a.useCallback)((()=>{var e;h({type:"ASSIGN_SOURCE_WALLET",data:null!==s&&void 0!==s?s:""}),h({type:"ASSIGN_SOURCE_ACCOUNT",data:null!==(e=p.find((e=>e.address===s)))&&void 0!==e?e:{}}),h({type:"CHANGE_DIRECTION",data:"send"}),h({type:"CHANGE_TOKEN_TYPE",data:"ft"}),h({type:"SHOW"})}),[s,h,p]),g=(0,a.useCallback)((()=>{h({type:"ASSIGN_SELECTED_FT",data:v[0]}),h({type:"ASSIGN_SOURCE_WALLET",data:null!==s&&void 0!==s?s:""}),h({type:"CHANGE_DIRECTION",data:"receive"}),h({type:"SHOW"})}),[s,h,v]);return(0,x.jsxs)(l.SC,{className:(0,m.Z)(d&&"text-secondary pointer-events-none"),id:`wallet_${i}`,children:[(0,x.jsx)(l.pj,{isLeft:!0,children:t}),(0,x.jsx)(l.pj,{children:i}),(0,x.jsxs)(l.pj,{children:[r," ICP"]}),(0,x.jsx)(l.pj,{children:n}),(0,x.jsx)(l.pj,{isRight:!0,className:"px-0",children:(0,x.jsx)(l.J2,{align:"end",trigger:(0,x.jsx)(l.K_,{className:(0,m.Z)("w-full",d&&"hidden")}),children:(0,x.jsx)(l.KN,{items:[{icon:(0,x.jsx)(l.Jr,{}),text:"Send",onClick:j},{icon:(0,x.jsx)(l.Jr,{className:"rotate-180"}),text:"Receive",onClick:g},c?{icon:(0,x.jsx)(l.T2,{}),text:"Archive",onClick:o}:{}]})})})]})},ae=e=>{let{wallets:s}=e;const[t,i]=(0,a.useState)(!1),[r,n]=(0,a.useState)(),{exchangeRate:d}=(0,U.G)(),{isAdmin:u}=c(),m=(0,a.useMemo)((()=>d?s.map(((e,s)=>{var t,a;return{id:s,uid:e.uid,address:e.address,name:e.name,number:s+1,tokenBalance:(0,k.e)(Number(null===(t=e.balance)||void 0===t?void 0:t.ICP)),USDBalance:(0,$.tF)(Number((0,k.e)(Number(null===(a=e.balance)||void 0===a?void 0:a.ICP))),d),isArchived:e.state===o.Q$.ARCHIVED,isAdmin:u}})):[]),[d,u,s]),v=(0,a.useCallback)(((e,t)=>{const a=s.find((e=>e.uid===t));n(a),"archive"===e&&i(!0)}),[s]);return(0,x.jsxs)(l.iA,{tableHeader:(0,x.jsx)(z,{}),children:[m.map((e=>(0,a.createElement)(te,{...e,key:`wallet_${e.uid}`,onArchive:()=>{var s;return v("archive",null!==(s=e.uid)&&void 0!==s?s:"")},isArchived:e.isArchived}))),(0,x.jsx)(q,{selectedWallet:r,isModalOpen:t,setIsModalOpen:i})]})},le=()=>{const[e,s]=(0,a.useState)(""),{wallets:t,isFetching:i}=C(),{isAdmin:r}=c(),n=(0,a.useMemo)((()=>t?t.filter((s=>{var t;return null===(t=s.name)||void 0===t?void 0:t.includes(e)})).sort(((e,s)=>e.state.localeCompare(s.state))):[]),[e,t]),o=(0,a.useCallback)((e=>{s(e.target.value)}),[]);return(0,x.jsxs)("div",{className:"border border-gray-200 rounded-xl mt-[30px]",children:[(0,x.jsx)(u.z,{onInputChange:o,actionButtons:r?(0,x.jsx)(Q,{}):(0,x.jsx)("div",{})}),(0,x.jsxs)("div",{className:"w-full px-5 overflow-x-auto",children:[(0,x.jsx)(ae,{wallets:n}),!n.length&&!i&&(0,x.jsx)(l.Sn,{className:"h-64",icon:(0,x.jsx)(l.Gg,{}),description:"Each vault can have as many wallets as you\u2019d like, each with its own transfer policy permissions."})]})]})},ie=[{label:"Wallets",content:(0,x.jsx)(le,{}),value:"wallets"},{label:"Members",content:(0,x.jsx)(N,{}),value:"members"},{label:"Policies",content:(0,x.jsx)(D,{}),value:"policies"},{label:"Transactions",content:(0,x.jsx)(J,{}),value:"transactions"}],re=()=>{const{vault:e,isFetching:s}=c();return(0,x.jsxs)(i.Z,{pageTitle:null===e||void 0===e?void 0:e.name,isLoading:s,showBackButton:!0,children:[(0,x.jsx)("p",{className:"mb-5 text-sm",children:null===e||void 0===e?void 0:e.description}),(0,x.jsx)(l.mQ,{tabs:ie,defaultValue:"wallets"})]})},ne=re},45482:(e,s,t)=>{t.d(s,{_:()=>u,k:()=>c});var a=t(87273),l=t(95163),i=t(96349),r=t(82898),n=t(46520),o=t(76058),d=t(33693);let c;!function(e){e.APPROVED="success",e.PENDING="warning",e.CANCELED="cancel",e.REJECTED="error"}(c||(c={}));const u=e=>{var s;const t=(0,l.s0)(),u=(0,a.useCallback)((()=>{t(`${n.Cb.base}/${n.Cb.vaults}/transactions/${e.id}`,{state:e})}),[t,e]),m=(0,a.useCallback)(((e,s)=>{e.stopPropagation(),navigator.clipboard.writeText(s),i.Am.success("Address copied to clipboard")}),[]);return(0,d.jsxs)(r.SC,{className:"space-x-5 hover:bg-gray-100",onClick:u,children:[(0,d.jsx)(r.pj,{isLeft:!0,children:e.number}),(0,d.jsx)(r.pj,{children:e.ownerName}),(0,d.jsx)(r.pj,{className:"hover:text-secondary",onClick:s=>m(s,e.fromAddress),children:(0,d.jsx)(r.u,{tip:"Copy to clipboard",children:(0,d.jsx)("span",{children:e.fromWalletName})})}),(0,d.jsx)(r.pj,{className:"hover:text-secondary",onClick:s=>m(s,e.toAddress),children:(0,d.jsx)(r.u,{tip:"Copy to clipboard",children:(0,d.jsx)(o.M,{value:e.toAddress,leadingChars:9,trailingChars:3})})}),(0,d.jsxs)(r.pj,{children:[(0,d.jsxs)("p",{children:[null===(s=e.amountICP)||void 0===s?void 0:s.toString()," ICP"]}),(0,d.jsx)("p",{className:"text-xs text-secondary",children:e.amountUSD})]}),(0,d.jsx)(r.pj,{children:(0,d.jsx)(r.Ct,{type:c[e.status],children:e.status})}),(0,d.jsx)(r.pj,{isRight:!0,children:(0,d.jsx)(r.xz,{className:"ml-auto text-secondary"})})]})}},35826:(e,s,t)=>{t.d(s,{Jv:()=>n,df:()=>d,zx:()=>o});var a=t(89158),l=t(55558),i=t(22599),r=t(6090);const n=e=>Math.floor(Number(e/BigInt(10**6))),o=(e,s,t)=>s&&!t?(0,a.Z)(e,s):!s&&t?(0,l.Z)(e,t):!s||!t||(0,a.Z)(e,s)&&(0,l.Z)(e,t),d=(e,s)=>e.sort(((e,t)=>{const a=s?(0,i.Z)(e.date,s,new Date):e.date,l=s?(0,i.Z)(t.date,s,new Date):t.date;return(0,r.Z)(a,l)}))}}]);
//# sourceMappingURL=534.9350eb29.chunk.js.map