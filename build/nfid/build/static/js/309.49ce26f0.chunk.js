"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[309],{24936:(e,t,s)=>{s.d(t,{z:()=>r});var a=s(18414),l=(s(87273),s(21882)),i=s(33693);const r=e=>{let{actionButtons:t,onInputChange:s,onInputType:r}=e;return(0,i.jsxs)("div",{className:(0,a.Z)("flex items-center justify-between","bg-gray-50 p-5 rounded-t-xl sm:rounded-b-md"),children:[(0,i.jsx)(l.II,{placeholder:"Search",icon:(0,i.jsx)(l.MN,{className:"w-4"}),onChange:s,onKeyDown:r,className:"sm:w-[350px]"}),t]})}},33492:(e,t,s)=>{s.d(t,{I:()=>n});var a=s(94244),l=s(36516),i=s(21325),r=s(67959);const n=()=>(0,a.ZP)("vaultDelegation",(()=>(0,r.a)()),{refreshInterval:l.EW,onSuccess:async e=>(e&&await(0,i.Ru)(i.UT,e),e)})},23370:(e,t,s)=>{s.d(t,{f:()=>r});var a=s(54915),l=s(87273),i=s(33492);const r=()=>{const{data:e,isLoading:t,isValidating:s}=(0,i.I)();return{address:(0,l.useMemo)((()=>e?(0,a.PZ)(e.getPrincipal(),Array(32).fill(1)):""),[e]),identity:e,isLoading:s,isReady:!t}}},810:(e,t,s)=>{s.d(t,{A:()=>i,D:()=>r});var a=s(21325),l=s(67959);const i=async e=>(await(0,a._w)()).find((t=>t.id===BigInt(e))),r=async()=>{const e=await(0,l.a)();return await(0,a.Ru)(a.UT,e),await(0,a._w)()}},22309:(e,t,s)=>{s.r(t),s.d(t,{VaultsDetailsCoordinator:()=>oe,default:()=>de});var a=s(87273),l=s(21882),i=s(17974),r=s(95163),n=s(94244),o=s(21325),d=s(810),c=s(23370);const u=()=>{const{vaultId:e}=(0,r.UO)(),{address:t}=(0,c.f)(),{data:s,isLoading:l,isValidating:i,mutate:u}=(0,n.ZP)(e?`vault_${e}`:null,(()=>(0,d.A)(null!==e&&void 0!==e?e:""))),m=(0,a.useMemo)((()=>{const e=null===s||void 0===s?void 0:s.members.find((e=>e.userId===t));return(null===e||void 0===e?void 0:e.role)===o.Oz.ADMIN}),[t,null===s||void 0===s?void 0:s.members]);return{isFetching:l||i,refetch:u,vault:s,isAdmin:m}};var m=s(24936),v=s(18414),p=s(84463),h=s(96349),x=s(33693);const g=()=>{var e,t;const[s,i]=(0,a.useState)(!1),[r,n]=(0,a.useState)(!1),{vault:d,refetch:m}=u(),{address:g}=(0,c.f)();a.useEffect((()=>{r&&null!==d&&void 0!==d&&d.id&&o.vF.addVaultMemberModalOpened(d.id.toString())}),[r,null===d||void 0===d?void 0:d.id]);const{register:j,handleSubmit:b,formState:y,resetField:f,reset:w}=(0,p.cI)({defaultValues:{name:"",address:""}});return(0,x.jsx)(l.TK,{large:!0,title:"Add member",isLoading:s,isModalOpen:r,isModalOpenChange:n,secondaryButton:{type:"stroke",text:"Cancel"},primaryButton:{type:"primary",onClick:b((async e=>{let{name:t,address:s}=e;if(null!==d&&void 0!==d&&d.id){if(s===g)return h.Am.warn("You're trying to invite yourself to the vault. Try another address."),n(!1),f("address");try{i(!0),await(0,o.ff)({memberAddress:s,name:t,vaultId:null===d||void 0===d?void 0:d.id,role:o.Oz.MEMBER,state:o.Q$.ACTIVE}),h.Am.success(`Member ${t} successfully added`),w()}catch(a){h.Am.error(a.message)}finally{i(!1),n(!1),await m(),o.vF.addVaultMemberCreated(d.id.toString())}}})),text:"Add",id:"add-member-button"},trigger:(0,x.jsxs)("div",{className:(0,v.Z)("flex items-center space-x-2 font-bold text-blue-600 cursor-pointer","hover:opacity-50 transition-opacity"),id:"add-member-trigger",children:[(0,x.jsx)(l.Ji,{className:"w-4"}),(0,x.jsx)("span",{className:"hidden text-sm sm:block",children:"Add member"})]}),children:(0,x.jsxs)("div",{className:"space-y-5",children:[(0,x.jsx)(l.II,{labelText:"Name",errorText:null===(e=y.errors.name)||void 0===e?void 0:e.message,...j("name",{required:"This field cannot be empty"})}),(0,x.jsx)(l.II,{labelText:"NFID address",errorText:null===(t=y.errors.address)||void 0===t?void 0:t.message,...j("address",{required:"This field cannot be empty"})})]})})},j=e=>{let{isModalOpen:t,setIsModalOpen:s,selectedMember:i}=e;const[r,n]=(0,a.useState)(!1),{vault:d,refetch:c}=u(),m=(0,a.useCallback)((async()=>{if(i&&null!==d&&void 0!==d&&d.id)try{var e;n(!0),await(0,o.ff)({...i,vaultId:BigInt(d.id),memberAddress:i.userId,name:null!==(e=i.name)&&void 0!==e?e:"",state:o.Q$.ARCHIVED})}catch(t){h.Am.error(t.message)}finally{n(!1),s(!1),h.Am.success("Vault member archived"),await c(),o.vF.vaultMemberArchived(d.id.toString())}}),[c,i,s,null===d||void 0===d?void 0:d.id]);return(0,x.jsx)(l.TK,{large:!0,title:"Archive member",isLoading:r,isModalOpen:t,isModalOpenChange:s,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"red",text:"Archive",onClick:m},children:(0,x.jsxs)("div",{className:"flex items-start gap-5",children:[(0,x.jsx)("div",{className:(0,v.Z)("w-16 h-16 flex items-center justify-center shrink-0","bg-gradient-to-br from-red-50 to-white rounded-3xl"),children:(0,x.jsx)(l.T2,{className:"text-red-500 w-7"})}),(0,x.jsxs)("p",{className:"text-sm",children:["This member will be excluded from this vault, and any pending transactions requiring their approval will need to be resubmitted.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"Archive ",(0,x.jsx)("strong",{children:null===i||void 0===i?void 0:i.name}),"?"]})]})})},b=e=>{var t;let{isModalOpen:s,setIsModalOpen:i,selectedMember:r}=e;const[n,d]=(0,a.useState)(!1),{vault:c,refetch:m}=u(),{register:v,handleSubmit:g,formState:j,reset:b}=(0,p.cI)({defaultValues:(0,a.useMemo)((()=>({name:null===r||void 0===r?void 0:r.name,userId:null===r||void 0===r?void 0:r.userId})),[null===r||void 0===r?void 0:r.name,null===r||void 0===r?void 0:r.userId])});(0,a.useEffect)((()=>{b(r)}),[b,r]);const y=(0,a.useCallback)((async e=>{if(r&&null!==c&&void 0!==c&&c.id)try{var t;d(!0),await(0,o.ff)({...r,vaultId:BigInt(c.id),memberAddress:r.userId,name:null!==(t=e.name)&&void 0!==t?t:""})}catch(s){h.Am.error(s.message)}finally{d(!1),i(!1),h.Am.success("Vault member updated"),await m(),o.vF.vaultMemberUpdated(c.id.toString())}}),[m,r,i,null===c||void 0===c?void 0:c.id]);return(0,x.jsxs)(l.TK,{large:!0,title:"Edit member",isLoading:n,isModalOpen:s,isModalOpenChange:i,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"primary",onClick:g(y),text:"Save"},children:[(0,x.jsx)(l.II,{labelText:"Name",errorText:null===(t=j.errors.name)||void 0===t?void 0:t.message,...v("name",{required:"First name must not be blank"})}),(0,x.jsx)(l.II,{disabled:!0,labelText:"NFID address",...v("userId")})]})},y=()=>(0,x.jsxs)(l.SC,{header:!0,children:[(0,x.jsx)(l.pj,{isLeft:!0,className:"w-10",children:"#"}),(0,x.jsx)(l.pj,{isLeft:!0,className:"w-auto",children:"Name"}),(0,x.jsx)(l.pj,{centered:!0,className:"w-32",children:"NFID address"}),(0,x.jsx)(l.pj,{centered:!0,className:"w-32",children:"Role"}),(0,x.jsx)(l.pj,{isRight:!0,className:"w-10"})]});var f=s(76058);const w=e=>{let{name:t,address:s,role:a,index:i,onEdit:r,onArchive:n,isArchived:o,isAdmin:d}=e;return(0,x.jsxs)(l.SC,{className:(0,v.Z)(o&&"text-secondary pointer-events-none"),id:`member_${t}`,children:[(0,x.jsx)(l.pj,{isLeft:!0,children:i}),(0,x.jsx)(l.pj,{children:t}),(0,x.jsx)(l.pj,{centered:!0,children:(0,x.jsx)(f.M,{value:s,leadingChars:9,trailingChars:3})}),(0,x.jsx)(l.pj,{centered:!0,children:a}),(0,x.jsx)(l.pj,{isRight:!0,className:"px-0",children:(0,x.jsx)(l.J2,{align:"end",trigger:(0,x.jsx)(l.K_,{className:(0,v.Z)("w-full",(o||!d)&&"hidden")}),children:(0,x.jsx)(l.KN,{items:[{icon:(0,x.jsx)(l.c,{}),text:"Edit",onClick:r},{icon:(0,x.jsx)(l.T2,{}),text:"Archive",onClick:n}]})})})]})},I=e=>{let{members:t}=e;const[s,i]=(0,a.useState)(!1),[r,n]=(0,a.useState)(!1),[d,c]=(0,a.useState)(),{isAdmin:m}=u(),v=(0,a.useMemo)((()=>t.map(((e,t)=>{var s;return{name:null!==(s=e.name)&&void 0!==s?s:"Unknown user",address:e.userId,role:e.role,index:t+1,isArchived:e.state===o.Q$.ARCHIVED,isAdmin:m}}))),[m,t]),p=(0,a.useCallback)(((e,s)=>{const a=t.find((e=>e.userId===s));c(a),"edit"===e&&i(!0),"archive"===e&&n(!0)}),[t]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(l.iA,{tableHeader:(0,x.jsx)(y,{}),children:v.map((e=>(0,a.createElement)(w,{...e,key:`vault_${e.address}`,onEdit:()=>p("edit",e.address),onArchive:()=>p("archive",e.address)})))}),(0,x.jsx)(b,{isModalOpen:s,setIsModalOpen:i,selectedMember:d}),(0,x.jsx)(j,{selectedMember:d,isModalOpen:r,setIsModalOpen:n})]})},N=()=>{const[e,t]=(0,a.useState)(""),{vault:s,isFetching:i,isAdmin:r}=u();a.useEffect((()=>{!i&&s&&(console.debug("VaultsMembersPage",{vault:s,isFetching:i}),o.vF.vaultMembersLoaded({vaultId:s.id.toString(),totalMembers:s.members.length,totalActiveMembers:s.members.filter((e=>e.state===o.Q$.ACTIVE)).length,totalInactiveMembers:s.members.filter((e=>e.state===o.Q$.ARCHIVED)).length}))}),[i,s]);const n=(0,a.useMemo)((()=>null!==s&&void 0!==s&&s.members?null===s||void 0===s?void 0:s.members.filter((t=>{var s;return!t.name||(null===(s=t.name)||void 0===s?void 0:s.includes(e))})).sort(((e,t)=>e.state.localeCompare(t.state))).sort(((e,t)=>e.role.localeCompare(t.role))):[]),[e,null===s||void 0===s?void 0:s.members]),d=(0,a.useCallback)((e=>{t(e.target.value)}),[]);return(0,x.jsxs)("div",{className:"border border-gray-200 rounded-xl mt-[30px]",children:[(0,x.jsx)(m.z,{onInputChange:d,actionButtons:r?(0,x.jsx)(g,{}):(0,x.jsx)("div",{})}),(0,x.jsxs)("div",{className:"w-full px-5 overflow-x-auto",children:[(0,x.jsx)(I,{members:n}),!n.length&&!i&&(0,x.jsx)(l.Sn,{className:"h-64",icon:(0,x.jsx)(l.oU,{}),description:"Add and manage team member permissions and roles."})]})]})};var A=s(94159);const C=()=>{const{vaultId:e}=(0,r.UO)(),{data:t,isLoading:s,isValidating:a,mutate:l}=(0,n.ZP)(e?`vault_${e}_wallets`:null,(()=>(0,o.MX)(BigInt(null!==e&&void 0!==e?e:"")))),{data:i,isValidating:d}=(0,n.ZP)(t?[t,"useVaultWallets"]:null,(async e=>{let[t]=e;return console.debug("useVaultWallets",{wallets:t}),await(0,A.SP)(t)}),{dedupingInterval:3e4,refreshInterval:6e4});return{vaultId:e,isFetching:s||a||d,refetch:l,wallets:i}},S=()=>{const{vaultId:e}=(0,r.UO)(),{wallets:t}=C(),{data:s,isLoading:l,isValidating:i,mutate:d}=(0,n.ZP)(e?`vault_${e}_policies`:null,(()=>(0,o.Ko)(BigInt(null!==e&&void 0!==e?e:"")))),c=(0,a.useMemo)((()=>null===s||void 0===s?void 0:s.map((e=>{var s;return{...e,walletName:e.wallets?null===t||void 0===t||null===(s=t.find((t=>t.uid===(e.wallets&&e.wallets[0]))))||void 0===s?void 0:s.name:"Any"}}))),[s,t]);return{vaultId:e,isFetching:l||i,refetch:d,policies:c}},T=()=>(0,x.jsx)(l.u,{tip:(0,x.jsxs)("ul",{className:"text-xs max-w-[360px] list-disc leading-4 space-y-1",children:[(0,x.jsx)("li",{children:"Individual wallet policies take precedent over policies applied to all wallets."}),(0,x.jsx)("li",{children:"If a wallet (or Any source) has one or more policies available, a transaction will trigger the policy with the highest value first and approver threshold next."}),(0,x.jsx)("li",{children:"Make sure no gaps exist in your policy workflows."}),(0,x.jsx)("li",{children:"Known shortcomings: Policies can have more approvers than members in a vault."})]}),className:"!px-3",children:(0,x.jsx)(l.Ek,{className:"text-secondary cursor-pointer"})});var M=s(94480),k=s(51921);const E=()=>{var e,t;const[s,i]=(0,a.useState)([]),[r,n]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!1),{refetch:m}=S(),{wallets:g}=C(),{vault:j}=u();a.useEffect((()=>{d&&null!==j&&void 0!==j&&j.id&&o.vF.addVaultPolicyModalOpened(j.id.toString())}),[d,null===j||void 0===j?void 0:j.id]);const b=(0,a.useMemo)((()=>{const e=null===g||void 0===g?void 0:g.map((e=>{var t,s;return{label:null!==(t=e.name)&&void 0!==t?t:"",value:null!==(s=e.uid)&&void 0!==s?s:"",disabled:e.state===o.Q$.ARCHIVED}}));return null===e||void 0===e||e.unshift({label:"Any",value:"Any",disabled:!1}),e}),[g]),{register:y,handleSubmit:f,formState:w,reset:I}=(0,p.cI)({defaultValues:{amount:0,approvers:0}});return(0,x.jsx)(l.TK,{large:!0,title:"Add policy",isLoading:r,isModalOpen:d,isModalOpenChange:c,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"primary",onClick:f((async e=>{let{amount:t,approvers:a}=e;if(null!==j&&void 0!==j&&j.id){if(!s.length)return h.Am.error("Source wallet is a required field");try{n(!0),await(0,o.DX)({vaultId:null===j||void 0===j?void 0:j.id,amountThreshold:BigInt((0,k.Q)(String(t))),currency:o.F.ICP,memberThreshold:Number(a),type:o.Mi.THRESHOLD_POLICY,wallets:"Any"===s[0]?void 0:s}),I(),h.Am.success("Policy successfully added"),o.vF.vaultPolicyCreated(j.id.toString())}catch(l){h.Am.error("Failed to add policy"),console.log({e:l}),h.Am.error(l.message)}finally{n(!1),c(!1),await m()}}})),text:"Add",id:"create-policy-button"},trigger:(0,x.jsxs)("div",{className:(0,v.Z)("flex items-center space-x-2 font-bold text-blue-600 cursor-pointer","hover:opacity-50 transition-opacity"),id:"create-policy-trigger",children:[(0,x.jsx)(l.Ji,{className:"w-4"}),(0,x.jsx)("span",{className:"hidden text-sm sm:block",children:"Add policy"})]}),children:(0,x.jsxs)("div",{className:"space-y-5",id:"create-policy-modal",children:[(0,x.jsx)(l.TV,{label:"Source (transactions sourced from this wallet)",options:null!==b&&void 0!==b?b:[],selectedValues:s,setSelectedValues:i,isMultiselect:!1,placeholder:"Select wallet",id:"select-wallet"}),(0,x.jsxs)("div",{className:"grid grid-cols-2 gap-5",children:[(0,x.jsx)(l.II,{labelText:"Greater than (that are greater than)",type:"number",innerText:"ICP",errorText:null===(e=w.errors.amount)||void 0===e?void 0:e.message,...y("amount",{required:"This field cannot be empty"})}),(0,x.jsx)(l.II,{labelText:"Approvers",type:"number",innerText:`of ${null===j||void 0===j?void 0:j.members.length}`,errorText:null===(t=w.errors.approvers)||void 0===t?void 0:t.message,...y("approvers",{required:"This field cannot be empty",validate:(0,M._)({min:1,max:255,toLowError:"Minimum amount is 1",toBigError:"Maximum amount is 255"})})})]})]})})},O=e=>{let{isModalOpen:t,setIsModalOpen:s,selectedPolicy:i}=e;const[r,n]=(0,a.useState)(!1),{refetch:d}=S(),c=(0,a.useCallback)((async()=>{if(i)try{n(!0),await(0,o.i5)({...i,state:o.Q$.ARCHIVED})}catch(e){h.Am.error(e.message)}finally{n(!1),s(!1),h.Am.success("Policy archived"),await d(),o.vF.vaultPolicyArchived(i.vault.toString())}}),[d,i,s]);return(0,x.jsx)(l.TK,{large:!0,title:"Archive policy",isLoading:r,isModalOpen:t,isModalOpenChange:s,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"red",text:"Archive",onClick:c},children:(0,x.jsxs)("div",{className:"flex items-start gap-5",children:[(0,x.jsx)("div",{className:(0,v.Z)("w-16 h-16 flex items-center justify-center shrink-0","bg-gradient-to-br from-red-50 to-white rounded-3xl"),children:(0,x.jsx)(l.T2,{className:"text-red-500 w-7"})}),(0,x.jsxs)("p",{className:"text-sm",children:["This wallet, along with its policies and transactions, will be excluded from your Vault pages.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"Archive policy?"]})]})})},V=e=>{var t,s;let{isModalOpen:i,setIsModalOpen:r,selectedPolicy:n}=e;const[d,c]=(0,a.useState)(!1),{refetch:m}=S(),{vault:v}=u(),{register:g,handleSubmit:j,formState:b,reset:y}=(0,p.cI)({defaultValues:(0,a.useMemo)((()=>({amount:Number((0,k.e)(Number(null===n||void 0===n?void 0:n.amountThreshold))),approvers:Number(null===n||void 0===n?void 0:n.memberThreshold),wallet:String(null!==n&&void 0!==n&&n.wallets?n.wallets[0]:"Any")})),[null===n||void 0===n?void 0:n.amountThreshold,null===n||void 0===n?void 0:n.memberThreshold,null===n||void 0===n?void 0:n.wallets])});(0,a.useEffect)((()=>{y({amount:Number((0,k.e)(Number(null===n||void 0===n?void 0:n.amountThreshold))),approvers:Number(null===n||void 0===n?void 0:n.memberThreshold),wallet:String(null!==n&&void 0!==n&&n.wallets?n.wallets[0]:"Any")})}),[y,n]);const f=(0,a.useCallback)((async e=>{if(n)try{c(!0),await(0,o.i5)({...n,amountThreshold:BigInt((0,k.Q)(String(e.amount))),memberThreshold:Number(e.approvers)})}catch(t){h.Am.error(t.message)}finally{c(!1),r(!1),h.Am.success("Vault policy updated"),await m(),o.vF.vaultPolicyUpdated(n.vault.toString())}}),[m,n,r]);return(0,x.jsx)(l.TK,{large:!0,title:"Edit policy",isLoading:d,isModalOpen:i,isModalOpenChange:r,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"primary",onClick:j(f),text:"Save"},children:(0,x.jsxs)("div",{className:"space-y-5",children:[(0,x.jsx)(l.II,{disabled:!0,labelText:"Transactions sourced from this wallet",...g("wallet")}),(0,x.jsx)(l.II,{labelText:"That are greater than",type:"number",innerText:"ICP",errorText:null===(t=b.errors.amount)||void 0===t?void 0:t.message,...g("amount",{required:"This field cannot be empty"})}),(0,x.jsx)(l.II,{labelText:"Will require this number of approvers",type:"number",innerText:`of ${null===v||void 0===v?void 0:v.members.length}`,errorText:null===(s=b.errors.approvers)||void 0===s?void 0:s.message,...g("approvers",{required:"This field cannot be empty",validate:(0,M._)({min:1,max:255,toLowError:"Minimum amount is 1",toBigError:"Maximum amount is 255"})})})]})})},F=()=>(0,x.jsxs)(l.SC,{header:!0,children:[(0,x.jsx)(l.pj,{isLeft:!0,className:"w-2",children:"#"}),(0,x.jsx)(l.pj,{className:"w-auto",children:"Source"}),(0,x.jsx)(l.pj,{className:"w-44",children:"Greater than"}),(0,x.jsx)(l.pj,{centered:!0,className:"w-44",children:"Approvers"}),(0,x.jsx)(l.pj,{isRight:!0,className:"w-10"})]}),L=e=>{let{number:t,source:s,greaterThan:a,approvers:i,onArchive:r,onEdit:n,isArchived:o,isAdmin:d}=e;return(0,x.jsxs)(l.SC,{className:(0,v.Z)(o&&"text-secondary pointer-events-none"),id:"policy_row",children:[(0,x.jsx)(l.pj,{isLeft:!0,children:t}),(0,x.jsx)(l.pj,{children:s}),(0,x.jsx)(l.pj,{children:a}),(0,x.jsx)(l.pj,{centered:!0,children:i}),(0,x.jsx)(l.pj,{isRight:!0,className:"px-0",children:(0,x.jsx)(l.J2,{align:"end",trigger:(0,x.jsx)(l.K_,{className:(0,v.Z)("w-full",(o||!d)&&"hidden")}),children:(0,x.jsx)(l.KN,{items:[{icon:(0,x.jsx)(l.c,{}),text:"Edit",onClick:n},{icon:(0,x.jsx)(l.T2,{}),text:"Archive",onClick:r}]})})})]})},B=e=>{let{policies:t}=e;const[s,i]=(0,a.useState)(!1),[r,n]=(0,a.useState)(!1),[d,c]=(0,a.useState)(),{vault:m,isAdmin:v}=u(),p=(0,a.useMemo)((()=>t.map(((e,t)=>({id:e.id,number:t+1,source:e.walletName,greaterThan:`${(0,k.e)(Number(e.amountThreshold))} ${e.currency}`,approvers:e.memberThreshold?`${e.memberThreshold} of ${null===m||void 0===m?void 0:m.members.length}`:"All",isArchived:e.state===o.Q$.ARCHIVED,isAdmin:v})))),[v,t,null===m||void 0===m?void 0:m.members.length]),h=(0,a.useCallback)(((e,s)=>{const a=t.find((e=>e.id===BigInt(s)));c(a),"archive"===e&&i(!0),"edit"===e&&n(!0)}),[t]);return(0,x.jsxs)(l.iA,{tableHeader:(0,x.jsx)(F,{}),children:[p.map((e=>(0,a.createElement)(L,{...e,key:`policy_${e.id}`,onArchive:()=>{var t;return h("archive",null!==(t=String(e.id))&&void 0!==t?t:"")},onEdit:()=>{var t;return h("edit",null!==(t=String(e.id))&&void 0!==t?t:"")},isArchived:e.isArchived}))),(0,x.jsx)(O,{selectedPolicy:d,isModalOpen:s,setIsModalOpen:i}),(0,x.jsx)(V,{selectedPolicy:d,isModalOpen:r,setIsModalOpen:n})]})},P=()=>{const[e,t]=(0,a.useState)(""),{policies:s,isFetching:i}=S(),{vault:r,isAdmin:n}=u();a.useEffect((()=>{r&&s&&(console.debug("VaultsPoliciesPage",{vault:r,policies:s,isFetching:i}),o.vF.vaultPoliciesLoaded(r.id.toString(),r.policies.length))}),[i,s,r]);const d=(0,a.useMemo)((()=>s?s.filter((t=>{var s;return null===t||void 0===t||null===(s=t.walletName)||void 0===s?void 0:s.includes(e)})).sort(((e,t)=>Number(e.createdDate)-Number(t.createdDate))):[]),[s,e]),c=(0,a.useCallback)((e=>{t(e.target.value)}),[]);return(0,x.jsxs)("div",{className:"border border-gray-200 rounded-xl mt-[30px]",children:[(0,x.jsx)(m.z,{onInputChange:c,actionButtons:(0,x.jsxs)("div",{className:"flex space-x-5",children:[n?(0,x.jsx)(E,{}):null,(0,x.jsx)(T,{})]})}),(0,x.jsxs)("div",{className:"w-full px-5 overflow-x-auto",children:[(0,x.jsx)(B,{policies:d}),!d.length&&!i&&(0,x.jsx)(l.Sn,{className:"h-64",icon:(0,x.jsx)(l.Ux,{}),description:"Manage the policies for wallets in your vault."})]})]})};var _=s(86672);const D=e=>{let{initiatorsOptions:t,statusOptions:s,initiatedFilter:a,setInitiatedFilter:i,statusFilter:r,setStatusFilter:n,timeFilter:o,setTimeFilter:d,onResetFilters:c,onApplyFilters:u}=e;return(0,x.jsx)(l.EZ,{onReset:c,onApply:u,trigger:(0,x.jsx)(l.Z_,{className:"transition-opacity cursor-pointer hover:opacity-60"}),align:"end",children:(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsx)(l.II,{type:"date",labelText:"From",onChange:e=>d({...o,from:e.target.value}),value:o.from}),(0,x.jsx)("div",{className:"w-1 h-[1px] block bg-black shrink-0 mt-6"}),(0,x.jsx)(l.II,{type:"date",labelText:"To",onChange:e=>d({...o,to:e.target.value}),value:o.to})]}),(0,x.jsx)(l.TV,{options:t,selectedValues:a,setSelectedValues:i,label:"Initiated"}),(0,x.jsx)(l.TV,{options:s,selectedValues:r,setSelectedValues:n,label:"Status"})]})})};var R=s(13791),Z=s(3209),$=s(54915),U=s(75557),W=s(43185);const H=()=>(0,x.jsxs)(l.SC,{header:!0,children:[(0,x.jsx)(l.pj,{isLeft:!0,className:"w-2",children:"#"}),(0,x.jsx)(l.pj,{className:"w-auto",children:"Initiated"}),(0,x.jsx)(l.pj,{className:"w-32",children:"From"}),(0,x.jsx)(l.pj,{className:"w-32",children:"To"}),(0,x.jsx)(l.pj,{className:"w-36",children:"Tokens"}),(0,x.jsx)(l.pj,{className:"w-36",children:"Status"}),(0,x.jsx)(l.pj,{isRight:!0,className:"w-10"})]});var K=s(45482);const G=e=>{let{transactions:t}=e;const{vault:s}=u(),{wallets:i}=C(),{exchangeRate:r}=(0,W.G)(),{address:n}=(0,c.f)(),o=(0,a.useMemo)((()=>(console.log({transactions:t}),t.map(((e,t)=>{var a,l;return{number:t+1,fromWalletName:null!==(a=null===i||void 0===i||null===(l=i.find((t=>t.uid===e.from_sub_account)))||void 0===l?void 0:l.name)&&void 0!==a?a:"",toAddress:e.to,ownerName:e.owner,id:e.id,status:e.state,amountICP:(0,k.e)(Number(e.amount)),amountUSD:(0,U.tF)(Number((0,k.e)(Number(e.amount))),null!==r&&void 0!==r?r:0),fromAddress:(0,$.PZ)(R.Principal.fromText(VAULT_CANISTER_ID),(0,$.Wu)(e.from_sub_account)),createdDate:(0,Z.Z)(new Date((0,_.Jv)(e.createdDate)),"MMM dd, yyyy - hh:mm:ss aaa"),approvers:null===s||void 0===s?void 0:s.members.map((t=>({name:t.name,isApproved:-1!==e.approves.findIndex((e=>e.signer===t.userId))}))).sort(((e,t)=>Number(t.isApproved)-Number(e.isApproved))),memberThreshold:e.memberThreshold,isInitiatedByYou:e.owner===n,isApprovedByYou:-1!==e.approves.findIndex((e=>e.signer===n)),memo:e.memo,vaultId:null===s||void 0===s?void 0:s.id}})))),[r,t,n,null===s||void 0===s?void 0:s.id,null===s||void 0===s?void 0:s.members,i]);return(0,x.jsx)(l.iA,{tableHeader:(0,x.jsx)(H,{}),children:o.map((e=>(0,a.createElement)(K._,{...e,key:`transaction_${e.id}`})))})},J={from:"",to:""},Q=()=>{const[e,t]=(0,a.useState)(""),[s,i]=(0,a.useState)([]),[d,c]=(0,a.useState)([]),[v,p]=(0,a.useState)(J),{transactions:h,isFetching:g}=(()=>{const{vaultId:e}=(0,r.UO)(),{data:t,isLoading:s,isValidating:l,mutate:i}=(0,n.ZP)(e?`vault_${e}_transactions`:null,(()=>(0,o.HL)())),d=(0,a.useMemo)((()=>null===t||void 0===t?void 0:t.filter((t=>t.vaultId===BigInt(null!==e&&void 0!==e?e:0)))),[t,e]);return{allTransactions:t,isFetching:s||l,refetch:i,transactions:d}})(),{vault:j}=u();a.useEffect((()=>{j&&h&&o.vF.vaultTransactionsLoaded({vaultId:j.id.toString(),totalTransactions:h.length,viewIsFiltered:!!e||!!s.length||!!v})}),[s.length,e,v,h,j]);const b=(0,a.useMemo)((()=>{var e;return null!==(e=null===j||void 0===j?void 0:j.members.map((e=>{var t;return{label:null!==(t=e.name)&&void 0!==t?t:"Unknown user",value:e.userId}})))&&void 0!==e?e:[]}),[null===j||void 0===j?void 0:j.members]),y=(0,a.useMemo)((()=>Object.values(o.g7).map((e=>({label:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase(),value:e})))),[]),f=(0,a.useCallback)((()=>{c([]),i([]),p(J)}),[]),w=(0,a.useMemo)((()=>h?h.map((e=>{var t,s;return{...e,owner:null!==(t=null===j||void 0===j||null===(s=j.members.find((t=>t.userId===e.owner)))||void 0===s?void 0:s.name)&&void 0!==t?t:e.owner}})).filter((t=>null===t||void 0===t?void 0:t.owner.includes(e))).filter((e=>!d.length||d.includes(e.state))).filter((e=>!s.length||s.includes(e.owner))).filter((e=>v.from.length||v.to.length?(0,_.zx)(new Date((0,_.Jv)(e.createdDate)),v.from.length?new Date(v.from):void 0,v.to.length?new Date(v.to):void 0):e)):[]),[h,null===j||void 0===j?void 0:j.members,e,d,s,v.from,v.to]),I=(0,a.useCallback)((e=>{t(e.target.value)}),[]);return(0,x.jsxs)("div",{className:"border border-gray-200 rounded-xl mt-[30px]",children:[(0,x.jsx)(m.z,{onInputChange:I,actionButtons:(0,x.jsxs)("div",{className:"flex items-center justify-end w-full ml-4 space-x-5",children:[(0,x.jsx)(D,{initiatorsOptions:b,statusOptions:y,initiatedFilter:s,setInitiatedFilter:e=>i(e),statusFilter:d,setStatusFilter:e=>c(e),timeFilter:v,setTimeFilter:p,onResetFilters:f}),(0,x.jsx)(l.fV,{className:"transition-opacity cursor-pointer hover:opacity-60"})]})}),(0,x.jsxs)("div",{className:"w-full px-5 overflow-x-auto",children:[(0,x.jsx)(G,{transactions:w}),!w.length&&!g&&(0,x.jsx)(l.Sn,{className:"h-64",icon:(0,x.jsx)(l.lA,{}),description:"No recent transactions to display."})]})]})};var q=s(7863);const z=()=>{var e;const[t,s]=(0,a.useState)(!1),[i,r]=(0,a.useState)(!1),{vaultId:n,refetch:d}=C(),{register:c,handleSubmit:u,formState:m}=(0,p.cI)({defaultValues:{name:""}});a.useEffect((()=>{i&&o.vF.addVaultAccountModalOpened()}),[i]);return(0,x.jsx)(l.TK,{large:!0,title:"Add wallet",isLoading:t,isModalOpen:i,isModalOpenChange:r,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"primary",onClick:u((async e=>{let{name:t}=e;if(n)try{s(!0),await(0,o.LQ)({name:t,vaultId:BigInt(n)})}catch(a){h.Am.error(a.message)}finally{s(!1),r(!1),h.Am.success(`Wallet ${t} successfully added`),await d(),o.vF.vaultAccountCreated(n)}})),text:"Create",id:"create-wallet-button"},trigger:(0,x.jsxs)("div",{className:(0,v.Z)("flex items-center space-x-2 font-bold text-blue-600 cursor-pointer","hover:opacity-50 transition-opacity"),id:"create-wallet-trigger",children:[(0,x.jsx)(l.Ji,{className:"w-4"}),(0,x.jsx)("span",{className:"hidden text-sm sm:block",children:"Add wallet"})]}),children:(0,x.jsx)("div",{className:"space-y-5",children:(0,x.jsx)(l.II,{labelText:"Name",errorText:null===(e=m.errors.name)||void 0===e?void 0:e.message,...c("name",{required:"This field cannot be empty"})})})})},Y=e=>{let{isModalOpen:t,setIsModalOpen:s,selectedWallet:i}=e;const[r,n]=(0,a.useState)(!1),{refetch:d}=C(),c=(0,a.useCallback)((async()=>{if(i)try{n(!0),await(0,o.K8)({...i,state:o.Q$.ARCHIVED})}catch(e){h.Am.error(e.message)}finally{n(!1),s(!1),h.Am.success("Wallet archived"),await d()}}),[d,i,s]);return(0,x.jsx)(l.TK,{large:!0,title:"Archive wallet",isLoading:r,isModalOpen:t,isModalOpenChange:s,secondaryButton:{type:"stroke",onClick:()=>{},text:"Cancel"},primaryButton:{type:"red",text:"Archive",onClick:c},children:(0,x.jsxs)("div",{className:"flex items-start gap-5",children:[(0,x.jsx)("div",{className:(0,v.Z)("w-16 h-16 flex items-center justify-center shrink-0","bg-gradient-to-br from-red-50 to-white rounded-3xl"),children:(0,x.jsx)(l.T2,{className:"text-red-500 w-7"})}),(0,x.jsxs)("p",{className:"text-sm",children:["This wallet, along with its policies and transactions, will be excluded from your Vault pages.",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),"Archive ",(0,x.jsx)("strong",{children:null===i||void 0===i?void 0:i.name}),"?"]})]})})},X=()=>(0,x.jsxs)(l.SC,{header:!0,children:[(0,x.jsx)(l.pj,{isLeft:!0,className:"w-2",children:"#"}),(0,x.jsx)(l.pj,{className:"w-auto",children:"Name"}),(0,x.jsx)(l.pj,{className:"w-44",children:"Token balance"}),(0,x.jsx)(l.pj,{className:"w-44",children:"USD balance"}),(0,x.jsx)(l.pj,{isRight:!0,className:"w-10"})]});var ee=s(55081),te=s(90651),se=s(95569),ae=s(81754);const le=e=>{let{address:t,number:s,name:i,tokenBalance:r,USDBalance:n,onArchive:d,isArchived:c,isAdmin:u}=e;const m=(0,a.useContext)(ae.J),{token:p}=(0,te.O)(),[,h]=(0,ee.L)(m.transferService),{wallets:g}=(0,se.w)(),j=(0,a.useCallback)((()=>{var e;o.JD.openModal({isOpenedFromVaults:!0}),h({type:"ASSIGN_SOURCE_WALLET",data:null!==t&&void 0!==t?t:""}),h({type:"ASSIGN_SOURCE_ACCOUNT",data:null!==(e=g.find((e=>e.address===t)))&&void 0!==e?e:{}}),h({type:"CHANGE_DIRECTION",data:"send"}),h({type:"CHANGE_TOKEN_TYPE",data:"ft"}),h({type:"ASSIGN_VAULTS",data:!0}),h({type:"SHOW"})}),[t,h,g]),b=(0,a.useCallback)((()=>{o.JD.openModal({isSending:!1,isOpenedFromVaults:!0}),h({type:"ASSIGN_SELECTED_FT",data:p[0]}),h({type:"ASSIGN_SOURCE_WALLET",data:null!==t&&void 0!==t?t:""}),h({type:"CHANGE_DIRECTION",data:"receive"}),h({type:"ASSIGN_VAULTS",data:!0}),h({type:"SHOW"})}),[t,h,p]);return(0,x.jsxs)(l.SC,{className:(0,v.Z)(c&&"text-secondary pointer-events-none"),id:`wallet_${i}`,children:[(0,x.jsx)(l.pj,{isLeft:!0,children:s}),(0,x.jsx)(l.pj,{children:i}),(0,x.jsxs)(l.pj,{children:[r," ICP"]}),(0,x.jsx)(l.pj,{children:n}),(0,x.jsx)(l.pj,{isRight:!0,className:"px-0",children:(0,x.jsx)(l.J2,{align:"end",trigger:(0,x.jsx)(l.K_,{className:(0,v.Z)("w-full",c&&"hidden")}),children:(0,x.jsx)(l.KN,{items:[{icon:(0,x.jsx)(l.Jr,{}),text:"Send",onClick:j},{icon:(0,x.jsx)(l.Jr,{className:"rotate-180"}),text:"Receive",onClick:b},u?{icon:(0,x.jsx)(l.T2,{}),text:"Archive",onClick:d}:{}]})})})]})},ie=e=>{let{wallets:t}=e;const[s,i]=(0,a.useState)(!1),[r,n]=(0,a.useState)(),{exchangeRate:d}=(0,W.G)(),{isAdmin:c}=u(),m=(0,a.useMemo)((()=>d?t.map(((e,t)=>{var s,a;return{id:t,uid:e.uid,address:e.address,name:e.name,number:t+1,tokenBalance:(0,k.e)(Number(null===(s=e.balance)||void 0===s?void 0:s.ICP)),USDBalance:(0,U.tF)(Number((0,k.e)(Number(null===(a=e.balance)||void 0===a?void 0:a.ICP))),d),isArchived:e.state===o.Q$.ARCHIVED,isAdmin:c}})):[]),[d,c,t]),v=(0,a.useCallback)(((e,s)=>{const a=t.find((e=>e.uid===s));n(a),"archive"===e&&i(!0)}),[t]);return(0,x.jsxs)(l.iA,{tableHeader:(0,x.jsx)(X,{}),children:[m.map((e=>(0,a.createElement)(le,{...e,key:`wallet_${e.uid}`,onArchive:()=>{var t;return v("archive",null!==(t=e.uid)&&void 0!==t?t:"")},isArchived:e.isArchived}))),(0,x.jsx)(Y,{selectedWallet:r,isModalOpen:s,setIsModalOpen:i})]})},re=()=>{const[e,t]=(0,a.useState)(""),{vaultId:s,wallets:i,isFetching:r}=C(),{isAdmin:n}=u();a.useEffect((()=>{if(!r&&s&&i){console.debug("VaultsWalletsPage",{wallets:i,isFetching:r});const e=i.reduce(((e,t)=>{let{balance:s}=t;return e+(s?s.ICP:BigInt(0))}),BigInt(0));o.vF.walletsLoaded({vaultId:s,totalAccounts:i.length,totalICPBalance:Number(e/BigInt(q.EZ))})}}),[i,r,s]);const d=(0,a.useMemo)((()=>i?i.filter((t=>{var s;return null===(s=t.name)||void 0===s?void 0:s.includes(e)})).sort(((e,t)=>e.state.localeCompare(t.state))):[]),[e,i]),c=(0,a.useCallback)((e=>{t(e.target.value)}),[]);return(0,x.jsxs)("div",{className:"border border-gray-200 rounded-xl mt-[30px]",children:[(0,x.jsx)(m.z,{onInputChange:c,actionButtons:n?(0,x.jsx)(z,{}):(0,x.jsx)("div",{})}),(0,x.jsxs)("div",{className:"w-full px-5 overflow-x-auto",children:[(0,x.jsx)(ie,{wallets:d}),!d.length&&!r&&(0,x.jsx)(l.Sn,{className:"h-64",icon:(0,x.jsx)(l.Gg,{}),description:"Each vault can have as many wallets as you\u2019d like, each with its own transfer policy permissions."})]})]})},ne=[{label:"Wallets",content:(0,x.jsx)(re,{}),value:"wallets"},{label:"Members",content:(0,x.jsx)(N,{}),value:"members"},{label:"Policies",content:(0,x.jsx)(P,{}),value:"policies"},{label:"Transactions",content:(0,x.jsx)(Q,{}),value:"transactions"}],oe=()=>{const{vault:e,isFetching:t}=u();return(0,x.jsxs)(i.Z,{pageTitle:null===e||void 0===e?void 0:e.name,isLoading:t,showBackButton:!0,children:[(0,x.jsx)("p",{className:"mb-5 text-sm",children:null===e||void 0===e?void 0:e.description}),(0,x.jsx)(l.mQ,{tabs:ne,defaultValue:"wallets"})]})},de=oe},45482:(e,t,s)=>{s.d(t,{_:()=>u,k:()=>c});var a=s(87273),l=s(95163),i=s(96349),r=s(21882),n=s(10682),o=s(76058),d=s(33693);let c;!function(e){e.APPROVED="success",e.PENDING="warning",e.CANCELED="cancel",e.REJECTED="error"}(c||(c={}));const u=e=>{var t;const s=(0,l.s0)(),u=(0,a.useCallback)((()=>{s(`${n.Cb.base}/${n.Cb.vaults}/transactions/${e.id}`,{state:e})}),[s,e]),m=(0,a.useCallback)(((e,t)=>{e.stopPropagation(),navigator.clipboard.writeText(t),i.Am.success("Address copied to clipboard")}),[]);return(0,d.jsxs)(r.SC,{className:"space-x-5 hover:bg-gray-100",onClick:u,children:[(0,d.jsx)(r.pj,{isLeft:!0,children:e.number}),(0,d.jsx)(r.pj,{children:e.ownerName}),(0,d.jsx)(r.pj,{className:"hover:text-secondary",onClick:t=>m(t,e.fromAddress),children:(0,d.jsx)(r.u,{tip:"Copy to clipboard",children:(0,d.jsx)("span",{children:e.fromWalletName})})}),(0,d.jsx)(r.pj,{className:"hover:text-secondary",onClick:t=>m(t,e.toAddress),children:(0,d.jsx)(r.u,{tip:"Copy to clipboard",children:(0,d.jsx)(o.M,{value:e.toAddress,leadingChars:9,trailingChars:3})})}),(0,d.jsxs)(r.pj,{children:[(0,d.jsxs)("p",{children:[null===(t=e.amountICP)||void 0===t?void 0:t.toString()," ICP"]}),(0,d.jsx)("p",{className:"text-xs text-secondary",children:e.amountUSD})]}),(0,d.jsx)(r.pj,{children:(0,d.jsx)(r.Ct,{type:c[e.status],children:e.status})}),(0,d.jsx)(r.pj,{isRight:!0,children:(0,d.jsx)(r.xz,{className:"ml-auto text-secondary"})})]})}},95569:(e,t,s)=>{s.d(t,{w:()=>m});var a=s(54915),l=s(87273),i=s(21325),r=s(14868),n=s(94244),o=s(94159),d=s(33492);var c=s(69491),u=s(93441);const m=()=>{const{balances:e,isLoading:t}=(0,r.j)(),{balances:s,isLoading:m}=(()=>{const{data:e}=(0,d.I)(),{data:t,isLoading:s}=(0,n.ZP)(e?"allVaultsWallets":null,(async()=>{const e=await(0,i._w)(),t=null===e||void 0===e?void 0:e.map((async e=>(await(0,i.MX)(e.id)).map((t=>({...t,vaultId:e.id,vaultName:e.name})))));return(await Promise.all(t)).flat(1).filter((e=>e.state!==i.Q$.ARCHIVED))})),{data:a,isValidating:l}=(0,n.ZP)(t?[t,"allVaultsWalletsBalances"]:null,(async e=>{let[t]=e;return console.debug("allVaultsWalletsBalances",{allVaultsWallets:t}),await(0,o.A1)(t)}),{dedupingInterval:3e4,refreshInterval:6e4});return{balances:a,isLoading:s||l}})(),v=(0,c.pq)();return{wallets:l.useMemo((()=>{var t;if(!e||!s)return[];const l=null===e||void 0===e?void 0:e.map((e=>{var t;let{principal:s,account:l,...r}=e;return{label:(0,i.w)(null!==(t=v.applicationsMeta)&&void 0!==t?t:[],l.domain,l.accountId),accountId:l.accountId,domain:l.domain,principal:s,address:(0,a.PZ)(s),...r}})).sort((0,u.E)((e=>{let{label:t}=e;return null!==t&&void 0!==t?t:""}))).concat(null!==(t=null===s||void 0===s?void 0:s.map((e=>{let{principal:t,account:s,address:a,...l}=e;return{label:s.label,accountId:s.accountId,domain:s.domain,principal:t,address:null!==a&&void 0!==a?a:s.accountId,isVaultWallet:!0,...l}})))&&void 0!==t?t:[]);return(0,u.h)((e=>{let{label:t}=e;return null!==t&&void 0!==t?t:""}),["NFID","NNS"])(l||[])}),[v.applicationsMeta,e,s]),isLoading:t||m}}},86672:(e,t,s)=>{s.d(t,{Jv:()=>n,zx:()=>o});var a=s(24832),l=s(83804);function i(e,t){(0,l.Z)(2,arguments);var s=(0,a.Z)(e),i=(0,a.Z)(t);return s.getTime()>i.getTime()}function r(e,t){(0,l.Z)(2,arguments);var s=(0,a.Z)(e),i=(0,a.Z)(t);return s.getTime()<i.getTime()}const n=e=>Math.floor(Number(e/BigInt(10**6))),o=(e,t,s)=>t&&!s?i(e,t):!t&&s?r(e,s):!t||!s||i(e,t)&&r(e,s)}}]);
//# sourceMappingURL=309.49ce26f0.chunk.js.map