"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[299],{51710:(e,t,s)=>{s.r(t),s.d(t,{default:()=>R});var n=s(64279),a=s(87273),c=s(8439),o=s(82898),i=s(54915),l=s(7863),r=s(23210),u=s(18414),d=s(74912),p=s(93302);const g=s.p+"static/media/nfid.2546d441d77e8702acfb8302ccf464ab.svg";var h=s(33693);const m=e=>{let{applicationLogo:t,applicationName:s,onReject:n,onApprove:a,accountsOptions:c,selectedAccounts:i,setSelectedAccounts:l,timer:r=!1}=e;return(0,h.jsx)(o.$$,{frameLabel:"Approve with NFID",children:(0,h.jsx)(p.B,{isLoading:!c.length,children:(0,h.jsxs)("div",{className:(0,u.Z)("flex flex-col flex-grow lg:justify-between","h-full"),children:[(0,h.jsxs)("div",{children:[(0,h.jsx)(o.x1,{applicationLogo:t,title:s,subTitle:"wants to perform the following actions:"}),(0,h.jsxs)("div",{className:(0,u.Z)("border border-gray-300 rounded-md","p-3 mt-4"),children:[(0,h.jsxs)("div",{className:"flex space-x-2.5 mb-2.5",children:[(0,h.jsx)("div",{className:(0,u.Z)("w-10 h-10 bg-gray-50 rounded-full","flex items-center justify-center","relative"),children:(0,h.jsx)(o.Ee,{className:"w-6",src:g,alt:"nfid"})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-sm font-semibold",children:"View your Web3 balance"}),(0,h.jsx)("p",{className:"text-xs text-secondary",children:"This site will see tokens and history from your selected accounts"})]})]}),(0,h.jsx)(o.TV,{disabled:-1!==r,isSearch:!0,options:c,selectedValues:i,setSelectedValues:l,placeholder:"None selected - connect anonymously",showSelectAllOption:!0})]})]}),(0,h.jsxs)("div",{className:(0,u.Z)("grid grid-cols-2 gap-5 mt-5 lg:mt-32",-1!==r&&"hidden"),children:[(0,h.jsx)(d.z,{stroke:!0,onClick:n,children:"Reject"}),(0,h.jsx)(d.z,{primary:!0,onClick:a,children:"Approve"})]}),(0,h.jsxs)(d.z,{className:(0,u.Z)("mt-5 lg:mt-32",-1===r&&"hidden"),block:!0,primary:!0,children:["Success! Closing in ",r]})]})})})};var v=s(27221);const f=e=>{let{applicationLogo:t,applicationName:s,onSuccess:n}=e;const[c,o]=(0,a.useState)([]),{wallets:u}=(0,r.w)(),{counter:d,setCounter:p}=(0,v.J)({defaultCounter:-1}),g=(0,a.useMemo)((()=>null===u||void 0===u?void 0:u.map((e=>{var t,s;return{label:null!==(t=e.label)&&void 0!==t?t:"",value:null!==(s=(0,i.PZ)(e.principal))&&void 0!==s?s:"",afterLabel:`${(0,l.T9)(e.balance.ICP)} ICP`}}))),[u]),f=(0,a.useCallback)((()=>{p(5),setTimeout((()=>n(c)),5e3)}),[p,n,c]);return(0,h.jsx)(m,{applicationName:s,applicationLogo:t,onReject:()=>window.close(),onApprove:f,accountsOptions:null!==g&&void 0!==g?g:[],selectedAccounts:c,setSelectedAccounts:o,timer:d})};var x=s(53844),A=s(84732),b=s(20663),j=s(29323);let S;const C=(0,x.C)({context:{},tsTypes:{},schema:{events:{}},initial:"Ready",states:{Ready:{invoke:{src:"registerRequestAccountsHandler",id:"registerRequestAccountsHandler",onDone:[{target:"Authenticate",actions:"assignRequestAccountsRequest"}]}},Authenticate:{invoke:{src:"AuthenticationMachine",id:"AuthenticationMachine",onDone:[{target:"RequestAccounts",actions:"assignAuthSession"}],data:e=>({appMeta:e.appMeta})}},RequestAccounts:{on:{SUCCESS:{target:"Confirm",actions:"assignAccounts"}}},Confirm:{onEntry:"setAccounts"},End:{type:"final"}},id:"RequestAccountsProvider"},{actions:{assignAuthSession:(0,A.f0)(((e,t)=>({authSession:t.data}))),assignRequestAccountsRequest:(0,A.f0)({requestAccounts:(e,t)=>t.data}),assignAccounts:(0,A.f0)({accounts:(e,t)=>t.accounts}),setAccounts:e=>{console.log({accounts:S,data:e}),S=e.accounts}},services:{async registerRequestAccountsHandler(){const e=await(0,b.registerRequestAccountsHandler)((()=>new Promise((e=>{setInterval((()=>{S&&e({status:"SUCCESS",accounts:S})}),1e3)}))));return console.debug("registerRequestAccountsHandler",{params:e}),e},AuthenticationMachine:j.Z},guards:{}});var y=s(8880);function R(){var e,t,s,i,l,r;const[u]=(0,c.lr)(),d=u.get("applicationName"),g=u.get("applicationLogo"),[m,v]=(0,n.e)(C.withConfig({},{appMeta:{name:d||"",logo:g||""}}));switch((0,a.useEffect)((()=>{console.debug("RequestAccountsCoordinator",{state:m.value})}),[m]),!0){case m.matches("Ready"):return(0,h.jsx)(p.B,{isLoading:!0,loadingMessage:`Connecting to ${null!==(e=null===(t=m.context)||void 0===t||null===(s=t.appMeta)||void 0===s?void 0:s.name)&&void 0!==e?e:"the application"}`});case m.matches("Authenticate"):return(0,h.jsx)(o.$$,{children:(0,h.jsx)(y.d,{actor:m.children.AuthenticationMachine,enforceSingleAccountScreen:!0})});case m.matches("RequestAccounts"):return(0,h.jsx)(f,{applicationName:null===(i=m.context)||void 0===i||null===(l=i.appMeta)||void 0===l?void 0:l.name,applicationLogo:null===(r=m.context.appMeta)||void 0===r?void 0:r.logo,onSuccess:e=>{v({type:"SUCCESS",accounts:e})}});default:return console.debug(`RequestAccounts rendering loader, unknown state: ${JSON.stringify(m.value)}`),(0,h.jsx)(p.B,{isLoading:!0})}}},27221:(e,t,s)=>{s.d(t,{J:()=>a});var n=s(87273);const a=e=>{let{defaultCounter:t,loop:s,frequency:a=1e3,onElapsed:c}=e;const[o,i]=n.useState(t),l=n.useRef(),[r,u]=n.useState(!1),d=n.useCallback((()=>{o>0&&i(o-1),0===o&&(u(!0),c&&c(),clearInterval(Number(l.current))),0===o&&s&&(i(t),l.current=setInterval(d,a),u(!1))}),[o,t,a,s,c]);return n.useEffect((()=>(l.current=setInterval(d,a),()=>clearInterval(Number(l.current)))),[a,d]),{elapsed:r,setCounter:i,counter:o}}}}]);
//# sourceMappingURL=299.e8796d7d.chunk.js.map