"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[284],{67284:(t,e,a)=>{a.r(e),a.d(e,{default:()=>V});var n=a(94244),s=a(21882),i=a(47200),r=a(17974),c=a(87273),o=a(3209),l=a(96349),d=a(50259),p=a(33693);const m={BTC:(0,p.jsx)(s.Fl,{}),ETH:(0,p.jsx)(s.fS,{}),IC:(0,p.jsx)(s.UV,{})},u=(s.hF,t=>{let{action:e,asset:a,from:n,chain:i,timestamp:r,to:u,id:h}=t;const y=(0,c.useCallback)((t=>{l.Am.success("Address copied to clipboard"),navigator.clipboard.writeText(t)}),[]);return(0,p.jsxs)("tr",{id:h,className:"items-center text-sm transition-all border-b border-gray-200 hover:bg-gray-100 activity-row",children:[(0,p.jsxs)("td",{className:"flex items-center py-2.5",children:[(0,p.jsxs)("div",{className:"w-10 h-10 rounded-[9px] bg-gray-50 flex items-center justify-center relative",children:[(0,p.jsx)(s.sK,{className:"rotate-[135deg] text-gray-400"}),(0,p.jsx)("div",{className:"absolute w-[18px] h-[18px] right-0 bottom-0",children:m[i]})]}),(0,p.jsxs)("div",{className:"ml-2.5",children:[(0,p.jsx)("p",{className:"font-bold",children:e}),(0,p.jsx)("p",{className:"text-xs text-gray-400",children:(0,o.Z)(new Date(r),"HH:mm:ss aaa")})]})]}),"ft"===(null===a||void 0===a?void 0:a.type)?(0,p.jsx)("td",{className:"leading-5",children:(0,p.jsxs)("p",{className:"font-medium",children:[a.amount," ",a.currency]})}):(0,p.jsx)("td",{className:"leading-5",children:(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("img",{src:a.preview,className:"object-cover w-10 h-10"}),(0,p.jsx)("p",{className:"ml-2.5 font-semibold",children:a.name})]})}),(0,p.jsx)("td",{className:"transition-opacity cursor-pointer hover:opacity-50",onClick:()=>y(n),children:(0,d.a)(n,6,4)}),(0,p.jsx)("td",{className:"transition-opacity cursor-pointer hover:opacity-50",onClick:()=>y(u),children:(0,d.a)(u,6,4)})]})}),h=t=>{let{date:e,rows:a,groupIndex:n}=t;const s=(0,c.useCallback)((t=>"ft"===t.asset.type?`tx-${t.action}-${t.network}-${t.asset.currency}-${t.asset.type}-${t.asset.amount}-${t.asset.currency}-${t.timestamp.getTime()}-${t.from}-${t.to}`.replace(".","_"):`tx-${t.action}-${t.network}-${t.asset.type}-${t.asset.name}-${t.timestamp.getTime()}-${t.from}-${t.to}`.replace(".","_")),[]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("tr",{id:`group_${n}`,children:(0,p.jsx)("td",{className:"pt-5 text-sm font-bold text-gray-400",children:e})}),a.map(((t,e)=>(0,c.createElement)(u,{...t,id:s(t),key:`group_${n}_activity_${e}`})))]})};var y=a(96215);var g,x,w,f,v,b=a(27387),j=a(52259),I=a(33368),N=a(59375),A=a(98965),C=a(90195),E=a(21325),O=a(23439),k=a(33605);let T=(g=(0,A.Cache)(k.J,{ttl:3600}),x=(0,A.Cache)(k.J,{ttl:3600}),w=(0,A.Cache)(k.J,{ttl:3600}),f=(0,A.Cache)(k.J,{ttl:180}),v=class{constructor(t){this.config=void 0,this.config=t}getTokenConfig(){return this.config}getBlockchain(){return this.config.network}getIdentity(){return E.fD.get().delegationIdentity}mapActivitiesToRows(t,e){return t.map((t=>({action:t.action,network:e.network,chain:e.chain,asset:t.asset,type:t.asset.type,timestamp:t.date,from:t.from,to:t.to})))}async getActivitiesRows(){const t=await this.getActivities();return this.mapActivitiesToRows(t,this.config)}async getAllPrincipals(t){const e=await this.getProfile(),a=await this.getAccounts(!0),n=await(0,E.bt)(BigInt(e.anchor),a,e.wallet===E.TD.NFID);return t?n.reduce(((t,e)=>(t[e.account.domain]?t[e.account.domain].push(e):t[e.account.domain]=[e],t)),{}):n}async getProfile(){var t;return null!==(t=(0,E.SC)())&&void 0!==t?t:await(0,O.In)()}async getAccounts(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=await(0,O.pO)();if(!t)return e;return(await this.getApplications()).filter((t=>t.isNftStorage)).map(C.y).reduce(((t,e)=>t.find((t=>t.domain===e.domain&&t.accountId===e.accountId))?t:[...t,e]),e)}async getApplications(){return await(0,O.sH)()}},(0,N.Z)(v.prototype,"getAllPrincipals",[g],Object.getOwnPropertyDescriptor(v.prototype,"getAllPrincipals"),v.prototype),(0,N.Z)(v.prototype,"getProfile",[x],Object.getOwnPropertyDescriptor(v.prototype,"getProfile"),v.prototype),(0,N.Z)(v.prototype,"getAccounts",[w],Object.getOwnPropertyDescriptor(v.prototype,"getAccounts"),v.prototype),(0,N.Z)(v.prototype,"getApplications",[f],Object.getOwnPropertyDescriptor(v.prototype,"getApplications"),v.prototype),v);const $=new class extends T{async getActivities(){const t=this.getIdentity();return await(new b.E).getActivityByUser(t)}}({chain:j.qo.BTC,network:y.$O.BITCOIN,tokenStandard:I.v.BTC});const P=new class extends T{async getActivities(){const t=this.getIdentity();return await E.q_.getActivityByUser(t)}}({chain:j.qo.ETH,network:y.$O.ETHEREUM,tokenStandard:I.v.ETH});const S=new class extends T{async getActivities(){const t=this.getIdentity();return await E.cH.getActivityByUser(t)}}({chain:j.qo.ETH,network:y.$O.ETHEREUM,tokenStandard:I.v.ETH});const D=new class extends T{async getActivities(){const t=this.getIdentity();return await E.Jt.getActivityByUser(t)}}({chain:j.qo.ETH,network:y.$O.POLYGON_MUMBAI,tokenStandard:I.v.MATIC});const H=new class extends T{async getActivities(){const t=this.getIdentity();return await E.It.getActivityByUser(t)}}({chain:j.qo.ETH,network:y.$O.POLYGON,tokenStandard:I.v.MATIC});var M=a(54915),B=a(20430);function U(t){return Array.isArray(t)?t.map((t=>U(t))):null!=t&&t.constructor===Object?Object.keys(t).reduce(((e,a)=>({...e,[(0,B.camelCase)(a)]:U(t[a])})),{}):t}async function Z(t){return await t.json().then((t=>U(t))).then((t=>({totalCount:t.totalCount,transactions:t.transactions.map((t=>({blockIdentifier:t.blockIdentifier,transaction:{metadata:t.transaction.metadata,transactionIdentifier:t.transaction.transactionIdentifier,operations:t.transaction.operations.map((t=>({...t,amount:{currency:t.amount.currency,value:(Number(t.amount.value)/10**8).toString()}})))}})))})))}async function R(t){let e=(0,E.Qc)((0,M.PZ)(t));return await(0,E.L8)("POST",`${E.t$}/search/transactions`,e).then(Z)}let L,_;!function(t){t.SENT="Sent",t.RECEIVED="Received"}(L||(L={})),function(t){t.PENDING="Pending",t.SUCCESS="Success",t.FAILED="Failed",t.CANCELLED="Cancelled"}(_||(_={}));const q=(t,e)=>({id:t.transaction.transactionIdentifier.hash,date:new Date(Math.floor(t.transaction.metadata.timestamp/1e6)),from:t.transaction.operations[0].account.address,to:t.transaction.operations[1].account.address,transactionHash:t.transaction.transactionIdentifier.hash,action:e,asset:{type:"ft",currency:"ICP",amount:Math.abs(Number(t.transaction.operations[0].amount.value)),amountUSD:`${Math.abs(Number(t.transaction.operations[0].amount.value))}`}});const F=new class extends T{async getActivities(){const t=await this.getAllPrincipals(!1),e=t.map((t=>(0,M.PZ)(t.principal))),a=await async function(t){return(await Promise.all(t.map(R))).reduce(((t,e)=>{const a=t.transactions.map((t=>t.blockIdentifier.hash)),n=e.transactions.filter((t=>-1===a.indexOf(t.blockIdentifier.hash))).map((t=>t.blockIdentifier.hash));if(!n.length)return t;const s=e.transactions.filter((t=>-1!==n.indexOf(t.blockIdentifier.hash)));return{totalCount:t.totalCount+s.length,transactions:[...t.transactions,...s]}}),{totalCount:0,transactions:[]})}(t.map((t=>t.principal)));return n=a.transactions,s=e,n.map((t=>s.includes(t.transaction.operations[0].account.address)&&s.includes(t.transaction.operations[1].account.address)?[q(t,L.RECEIVED),q(t,L.SENT)]:[q(t,s.includes(t.transaction.operations[1].account.address)?L.RECEIVED:L.SENT)])).flat();var n,s}}({chain:j.qo.IC,network:y.$O.IC,tokenStandard:I.v.ICP}),G={[y.$O.ETHEREUM]:[P],[y.$O.ETHEREUM_GOERLI]:[S],[y.$O.POLYGON]:[H],[y.$O.POLYGON_MUMBAI]:[D],[y.$O.IC]:[F],[y.$O.BITCOIN]:[$]},J=async()=>(t=>{const e=t.reduce(((t,e)=>{const a=new Date(Number(e.timestamp)),n=(0,o.Z)(a,"MMMM d, yyyy");return t[n]||(t[n]=[]),t[n].push(e),t}),{}),a=Object.entries(e).map((t=>{let[e,a]=t;return{date:e,rows:a.sort(((t,e)=>e.timestamp.getTime()-t.timestamp.getTime()))}}));return a.sort(((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime()))})((await Promise.all(Object.values(G).flat().map((async t=>{try{return await t.getActivitiesRows()}catch(e){console.error(e)}})))).filter((t=>!!t)).flat()),V=()=>{const{isLoading:t,data:e}=(0,n.ZP)("activity",J);return(0,p.jsx)(r.Z,{isLoading:t,pageTitle:"Activity",showBackButton:!0,children:(0,p.jsx)(i.Z,{children:(0,p.jsx)(s.iA,{id:"activity-table",tableHeader:(0,p.jsxs)("tr",{className:"border-b border-black",children:[(0,p.jsx)("th",{children:"Action"}),(0,p.jsx)("th",{children:"Asset"}),(0,p.jsx)("th",{className:"hidden sm:table-cell",children:"From"}),(0,p.jsx)("th",{className:"hidden sm:table-cell",children:"To"})]}),children:null===e||void 0===e?void 0:e.map(((t,e)=>(0,p.jsx)(h,{groupIndex:e,date:t.date,rows:t.rows},`group_${e}`)))})})})}},47200:(t,e,a)=>{a.d(e,{Z:()=>i});var n=a(18414),s=(a(87273),a(33693));const i=t=>{let{title:e,subTitle:a,children:i,className:r,showChildrenPadding:c=!0,id:o}=t;return(0,s.jsxs)("div",{id:o,className:(0,n.Z)("block border border-gray-200 rounded-xl","py-4 sm:py-[26px]",r),children:[(0,s.jsxs)("div",{className:"px-5",children:[e&&(0,s.jsx)("div",{className:"flex items-center justify-between mb-3 text-xl",children:e}),a&&(0,s.jsx)("div",{className:"flex items-center justify-between mb-4 text-sm leading-5 text-secondary",children:a})]}),(0,s.jsx)("div",{className:(0,n.Z)(c&&"px-5 sm:px-[30px]"),children:i})]})}}}]);
//# sourceMappingURL=284.f55990bf.chunk.js.map