"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[479],{91748:(e,r,n)=>{n.r(r),n.d(r,{default:()=>f});var t=n(59794),s=n(87273),a=n(78765),i=n(95063),o=n(18414),c=n(84463),l=n(82898),d=n(74912),u=n(47200),h=n(72565),m=n(33693);const p=e=>{var r;let{isLoading:n,onSubmit:t,responseError:a,setResponseError:i}=e;const{formState:{errors:p},register:g,handleSubmit:b,setError:x}=(0,c.cI)({mode:"all"});return s.useEffect((()=>{var e;a&&(null===(e=p.phone)||void 0===e?void 0:e.message)!==a&&x("phone",{message:a})}),[p.phone,a,x]),(0,m.jsx)(h.Z,{pageTitle:"Add phone number",isLoading:n,showBackButton:!0,children:(0,m.jsxs)(u.Z,{children:[(0,m.jsxs)("div",{className:(0,o.Z)("text-sm"),children:[(0,m.jsx)("p",{children:"Verify your non-VOIP mobile phone number with NFID. Standard text messaging rates may apply."}),(0,m.jsxs)("p",{className:"mt-3 max-w-[766px]",children:["Your phone number can only be registered with one identity. To register it with your existing Internet Identity anchor please see these"," ",(0,m.jsx)("a",{className:"transition-opacity cursor-pointer text-blue hover:opacity-75",href:"https://docs.nfid.one/sign-in-with-ii-and-nfid",target:"_blank",rel:"noreferrer",children:"instructions"}),"."]})]}),(0,m.jsxs)("form",{className:(0,o.Z)("mt-5 flex flex-col flex-1","sm:block"),onSubmit:b(t),children:[(0,m.jsx)("div",{className:"space-y-2",children:(0,m.jsx)(l.II,{id:"phone-number",className:"max-w-[350px]",labelText:"Phone number",placeholder:"+1 234 856 7890",errorText:null===(r=p.phone)||void 0===r?void 0:r.message,onKeyUp:()=>i&&i(""),...g("phone",{required:l.DE.errorMessages.required,pattern:{value:l.DE.regex,message:l.DE.errorMessages.pattern},minLength:{value:l.DE.minLength,message:l.DE.errorMessages.length},maxLength:{value:l.DE.maxLength,message:l.DE.errorMessages.length}})})}),(0,m.jsx)(d.z,{id:"add-phone-number",primary:!0,className:"px-10 mt-3 sm:mt-5",onClick:b(t),children:"Verify phone number"})]})]})})};var g=n(19511),b=n(46520),x=n(1435);const f=()=>{const[,e]=(0,t.KO)(x.l),[r,n]=s.useReducer((e=>!e),!1),[o,c]=s.useState(""),{navigate:l}=(0,g.Z)(),{delegationIdentity:d}=a.fD.get(),u=s.useCallback((async r=>{let t,{phone:s}=r;if(!d)throw new Error("User delegation is undefined");n();try{return t=await(0,i.V)(s,d),e(s),l(`${b.Cb.base}/${b.Cb.credentials}/${b.Cb.verifySMS}`)}catch(a){a.message?c(a.message):c("This phone number is already registered"),console.debug("handleSubmitPhoneNumber",a)}finally{n()}return t}),[d,l,e]);return(0,m.jsx)(p,{onSubmit:u,isLoading:r,responseError:o,setResponseError:c})}},1435:(e,r,n)=>{n.d(r,{l:()=>t});const t=(0,n(59794).cn)(null)},95063:(e,r,n)=>{n.d(r,{V:()=>c});var t=n(46829),s=n(33896),a=n(71520),i=(n(46647),n(30935),n(78765)),o=n(15698);if(!VERIFY_PHONE_NUMBER)throw new Error("Phone verification lambda is not defined.");async function c(e,r){const n=i.ic.isLocal?"/verify":VERIFY_PHONE_NUMBER,c=e.replace(/\s/g,""),l={methodName:"validate_signature",arg:s.xO.encode([s.xO.Opt(s.xO.Text)],[[c]])},d=await(0,o.G)(r,IDENTITY_MANAGER_CANISTER_ID,l);let u=t.Cbor.encode(d.body),h=(0,a.zv)(u);const m=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:h})});if(console.debug("verifyPhoneNumber",{phoneNumber:e,fields:l,canister:IDENTITY_MANAGER_CANISTER_ID,response:m,principal:r.getPrincipal().toText()}),!m.ok){const e=await m.json().then((e=>e));throw console.log({errorObject:e}),Error(e.error)}return(await m.json()).phoneNumberEncrypted}},15698:(e,r,n)=>{n.d(r,{G:()=>a});var t=n(46829),s=n(13791);async function a(e,r,n){const a="string"===typeof r?s.Principal.fromText(r):r,i=e.getPrincipal(),o={request_type:"query",canister_id:a,method_name:n.methodName,arg:n.arg,sender:i,ingress_expiry:new t.Expiry(3e5)};return await e.transformRequest({request:{method:"POST",headers:Object.assign({"Content-Type":"application/cbor"})},endpoint:"query",body:o})}},47200:(e,r,n)=>{n.d(r,{Z:()=>a});var t=n(18414),s=(n(87273),n(33693));const a=e=>{let{title:r,subTitle:n,children:a,className:i,showChildrenPadding:o=!0,id:c}=e;return(0,s.jsxs)("div",{id:c,className:(0,t.Z)("block border border-gray-200 rounded-xl","py-4 sm:py-[26px]",i),children:[(0,s.jsxs)("div",{className:"px-5",children:[r&&(0,s.jsx)("div",{className:"flex items-center justify-between mb-3 text-xl",children:r}),n&&(0,s.jsx)("div",{className:"flex items-center justify-between mb-4 text-sm leading-5 text-secondary",children:n})]}),(0,s.jsx)("div",{className:(0,t.Z)(o&&"px-5 sm:px-[30px]"),children:a})]})}},55081:(e,r,n)=>{n.d(r,{L:()=>l});var t=n(87273),s=n(68682),a=n(49371),i=n(98740);function o(e){return"deferred"in e}function c(e){return"getSnapshot"in e?e.getSnapshot():function(e){return"state"in e}(e)?e.state:void 0}function l(e,r){void 0===r&&(r=c);var n=(0,t.useRef)(e),l=(0,t.useRef)([]),d=(0,t.useCallback)((function(r){return e.subscribe(r).unsubscribe}),[e]),u=(0,t.useCallback)((function(){return r(e)}),[e,r]),h=(0,i.useSyncExternalStore)(d,u,u),m=(0,a.Z)((function(){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e[0];var s=n.current;o(s)&&s.deferred?l.current.push(t):s.send(t)}}));return(0,s.Z)((function(){for(n.current=e;l.current.length>0;){var r=l.current.shift();e.send(r)}}),[e]),[h,m]}}}]);
//# sourceMappingURL=479.53152376.chunk.js.map