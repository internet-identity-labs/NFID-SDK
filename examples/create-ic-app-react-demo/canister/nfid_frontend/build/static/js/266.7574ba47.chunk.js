"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[266],{64266:(e,t,i)=>{i.r(t),i.d(t,{RouterRegisterDeviceDecider:()=>v,default:()=>y});var r=i(87273),s=i(95163),o=i(82898),a=i(78765),n=i(50778),c=i(1719),l=i(71287),u=i(4039),d=i(49247),h=i(67142),g=i(19511),m=i(33693);const v=e=>{let{registerSuccessPath:t}=e;const[i,v]=(0,r.useState)(!1),{recoverDevice:y,createSecurityDevice:f,hasSecurityKey:x}=(0,d.Ls)(),{recoverAccount:b,createAccount:w}=(0,u.m)(),{setShouldStoreLocalAccount:p}=(0,c.J)(),{generatePath:j}=(0,g.Z)(),{isAuthenticated:D}=(0,c.J)(),{platform:{os:N},hasPlatformAuthenticator:R}=(0,l.uw)();console.log(">> ",{hasWebAuthn:R});const k=(0,s.s0)(),{state:A}=(0,s.TH)(),S=BigInt(A.userNumber);console.debug("RouterRegisterDeviceDecider",{hasSecurityKey:x,hasWebAuthn:R}),r.useEffect((()=>{if(!R&&x)return k(j(t))}),[j,x,R,k,t]);const _=r.useCallback((async()=>{if(v(!0),p(!0),!S)return console.error(`Missing userNumber: ${S}`);try{await b(BigInt(S),!0)}catch(c){var e,i,r,s,o,n;console.warn("account not found. Recreating");const t={anchor:S},u={icon:(0,l.q7)(l.S3),device:l.S3.newDeviceName,browser:null!==(e=l.S3.browser.name)&&void 0!==e?e:"Mobile",pubKey:Array.from(new Uint8Array(null!==(i=null===(r=a.fD.get())||void 0===r||null===(s=r.delegationIdentity)||void 0===s?void 0:s.getPublicKey().toDer())&&void 0!==i?i:[]))};console.debug("RouterRegisterDeviceDecider handleRegister",{account:t,accessPoint:u}),await w(t,u);const d=null===(o=a.fD.get())||void 0===o||null===(n=o.delegationIdentity)||void 0===n?void 0:n.getPrincipal().toText(),h=await a.im.create_access_point({icon:"laptop",device:N,browser:(0,l.g_)(),pub_key:d}).catch((e=>{throw new Error(`RouterRegisterDeviceDecider.handleRegister im.create_access_point: ${e.message}`)}));200!==h.status_code&&console.error("failed to create access point",{error:h.error[0]}),a.im.use_access_point([(0,l.g_)()]).catch((e=>{throw new Error(`useAuthentication.loginWithRecovery im.use_access_point: ${e.message}`)}))}try{await y(Number(S))}catch(c){console.error(c)}k(j(t)),v(!1)}),[w,N,j,k,b,y,t,p,S]),P=r.useCallback((async()=>{v(!0),await f(),k(j(t)),v(!1)}),[f,j,k,t]),C=r.useCallback((async()=>{if(!S)throw new Error("userNumber is not defined. Not authorized.");v(!0),p(!1),await b(S,!1),v(!1),k(j(t))}),[j,k,b,t,p,S]);return(0,r.useEffect)((()=>{D||k(`${n.w.base}/${n.w.enterRecoveryPhrase}`)}),[D,k]),(0,m.jsx)(o.$$,{children:(0,m.jsx)(h.J,{onLogin:C,isLoading:i,isPlatformAuthenticatorAvailable:!!R,deviceName:l.S3.platform.device,platformAuthenticatorName:l.S3.platform.authenticator,onRegisterPlatformDevice:_,onRegisterSecurityDevice:P})})},y=v},93302:(e,t,i)=>{i.d(t,{B:()=>n});var r=i(18414),s=(i(87273),i(58688)),o=i(82389),a=i(33693);const n=e=>{let{isLoading:t,loadingMessage:i,children:n,className:c}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,r.Z)("w-full h-full",c),children:n}),t?(0,a.jsx)(o.B,{id:"loader",className:"absolute top-0 bottom-0 left-0 z-20 w-full rounded-xl",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full px-14",children:[(0,a.jsx)(s.a,{isLoading:t,fullscreen:!1,imageClasses:"w-[90px] mx-auto py-6 -mt-4 z-20"}),i&&(0,a.jsx)("div",{className:"z-20 mt-5 text-center",children:i})]})}):null]})}},67142:(e,t,i)=>{i.d(t,{J:()=>n});var r=i(18414),s=(i(87273),i(82898)),o=i(93302),a=i(33693);const n=e=>{let{isLoading:t,deviceName:i,platformAuthenticatorName:r,isPlatformAuthenticatorAvailable:n,loadingMessage:l,onLogin:u,onRegisterPlatformDevice:d,onRegisterSecurityDevice:h}=e;return(0,a.jsxs)(o.B,{isLoading:t,loadingMessage:l,children:[(0,a.jsx)(s.x1,{title:"Sign in faster on this device",subTitle:n?`Trust this ${i}? You can quickly and securely sign in next time using this device's ${r}.`:"You can quickly and securely sign in next time with a security key if you register one now."}),(0,a.jsx)("div",{className:"flex flex-col w-full space-y-1 mt-7",children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c,{id:"trust-this-device",title:"Trust this device",subtitle:`Use ${r} to continue`,handler:d}),(0,a.jsx)(c,{id:"just-log-me-in",title:"Don\u2019t trust this device",subtitle:"This device is public or someone else\u2019s",handler:u})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c,{id:"register-my-security-key",title:"Register my security key",subtitle:"Sign in faster with your security key",handler:h}),(0,a.jsx)(c,{id:"just-log-me-in",title:"Just log me in",subtitle:"I don\u2019t want to register a security key now",handler:u})]})})]})},c=e=>{let{title:t,subtitle:i,handler:s,id:o}=e;return(0,a.jsxs)("div",{id:o,className:(0,r.Z)("w-full py-[10px] px-4 border border-primaryButtonColor/30 rounded-md","hover:bg-primaryButtonColor/10 hover:border-primaryButtonColor/50 cursor-pointer transition-all"),onClick:s,children:[(0,a.jsx)("p",{className:"text-sm",children:t}),(0,a.jsx)("p",{className:"mt-0.5 text-xs text-secondary",children:i})]})}}}]);
//# sourceMappingURL=266.7574ba47.chunk.js.map